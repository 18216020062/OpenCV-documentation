<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>OpenCV: Histogram Comparison</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
MathJax.Hub.Config(
{
  TeX: {
      Macros: {
          matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
          fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
          forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
          vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
          vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
          hdotsfor: ["\\dots", 1],
          mathbbm: ["\\mathbb{#1}", 1],
          bordermatrix: ["\\matrix{#1}", 1]
      }
  }
}
);
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">3.0.0-rc1</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li><a href="../..//3.0-last-rst"><span>Sphinx&#160;Documentation</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="../../d7/da8/tutorial_table_of_content_imgproc.html">Image Processing (imgproc module)</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Histogram Comparison </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Goal </h2>
<p>In this tutorial you will learn how to:</p>
<ul>
<li>Use the function <a class="el" href="../../d6/dc7/group__imgproc__hist.html#gaf4190090efa5c47cb367cf97a9a519bd">cv::compareHist</a> to get a numerical parameter that express how well two histograms match with each other.</li>
<li>Use different metrics to compare histograms</li>
</ul>
<h2>Theory </h2>
<ul>
<li>To compare two histograms ( \(H_{1}\) and \(H_{2}\) ), first we have to choose a <em>metric</em> ( \(d(H_{1}, H_{2})\)) to express how well both histograms match.</li>
<li>OpenCV implements the function <a class="el" href="../../d6/dc7/group__imgproc__hist.html#gaf4190090efa5c47cb367cf97a9a519bd">cv::compareHist</a> to perform a comparison. It also offers 4 different metrics to compute the matching:<ol type="1">
<li><b>Correlation ( CV_COMP_CORREL )</b> <p class="formulaDsp">
\[d(H_1,H_2) = \frac{\sum_I (H_1(I) - \bar{H_1}) (H_2(I) - \bar{H_2})}{\sqrt{\sum_I(H_1(I) - \bar{H_1})^2 \sum_I(H_2(I) - \bar{H_2})^2}}\]
</p>
 where <p class="formulaDsp">
\[\bar{H_k} = \frac{1}{N} \sum _J H_k(J)\]
</p>
 and \(N\) is the total number of histogram bins.</li>
<li><b>Chi-Square ( CV_COMP_CHISQR )</b> <p class="formulaDsp">
\[d(H_1,H_2) = \sum _I \frac{\left(H_1(I)-H_2(I)\right)^2}{H_1(I)}\]
</p>
</li>
<li><b>Intersection ( method=CV_COMP_INTERSECT )</b> <p class="formulaDsp">
\[d(H_1,H_2) = \sum _I \min (H_1(I), H_2(I))\]
</p>
</li>
<li><b>Bhattacharyya distance ( CV_COMP_BHATTACHARYYA )</b> <p class="formulaDsp">
\[d(H_1,H_2) = \sqrt{1 - \frac{1}{\sqrt{\bar{H_1} \bar{H_2} N^2}} \sum_I \sqrt{H_1(I) \cdot H_2(I)}}\]
</p>
</li>
</ol>
</li>
</ul>
<h2>Code </h2>
<ul>
<li><b>What does this program do?</b><ul>
<li>Loads a <em>base image</em> and 2 <em>test images</em> to be compared with it.</li>
<li>Generate 1 image that is the lower half of the <em>base image</em></li>
<li>Convert the images to HSV format</li>
<li>Calculate the H-S histogram for all the images and normalize them in order to compare them.</li>
<li>Compare the histogram of the <em>base image</em> with respect to the 2 test histograms, the histogram of the lower half base image and with the same base image histogram.</li>
<li>Display the numerical matching parameters obtained.</li>
</ul>
</li>
<li><b>Downloadable code</b>: Click <a href="https://github.com/Itseez/opencv/tree/master/samples/cpp/tutorial_code/Histograms_Matching/compareHist_Demo.cpp">here</a></li>
<li><b>Code at glance:</b></li>
</ul>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/d87/imgcodecs_8hpp.html">opencv2/imgcodecs.hpp</a>&quot;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/dce/highgui_2highgui_8hpp.html">opencv2/highgui/highgui.hpp</a>&quot;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/dba/imgproc_2imgproc_8hpp.html">opencv2/imgproc/imgproc.hpp</a>&quot;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d8/dcc/namespacestd.html">std</a>;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d2/d75/namespacecv.html">cv</a>;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keywordtype">int</span> main( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv )</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;{</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> src_base, hsv_base;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> src_test1, hsv_test1;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> src_test2, hsv_test2;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> hsv_half_down;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="keywordflow">if</span>( argc &lt; 4 )</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    {</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        printf(<span class="stringliteral">&quot;** Error. Usage: ./compareHist_Demo &lt;image_settings0&gt; &lt;image_setting1&gt; &lt;image_settings2&gt;\n&quot;</span>);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    }</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    src_base = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>( argv[1], 1 );</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    src_test1 = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>( argv[2], 1 );</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    src_test2 = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>( argv[3], 1 );</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <a class="code" href="../../d7/d1b/group__imgproc__misc.html#ga397ae87e1288a81d2363b61574eb8cab">cvtColor</a>( src_base, hsv_base, <a class="code" href="../../d7/d1b/group__imgproc__misc.html#gga4e0972be5de079fed4e3a10e24ef5ef0aa4a7f0ecf2e94150699e48c79139ee12">COLOR_BGR2HSV</a> );</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <a class="code" href="../../d7/d1b/group__imgproc__misc.html#ga397ae87e1288a81d2363b61574eb8cab">cvtColor</a>( src_test1, hsv_test1, <a class="code" href="../../d7/d1b/group__imgproc__misc.html#gga4e0972be5de079fed4e3a10e24ef5ef0aa4a7f0ecf2e94150699e48c79139ee12">COLOR_BGR2HSV</a> );</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="../../d7/d1b/group__imgproc__misc.html#ga397ae87e1288a81d2363b61574eb8cab">cvtColor</a>( src_test2, hsv_test2, <a class="code" href="../../d7/d1b/group__imgproc__misc.html#gga4e0972be5de079fed4e3a10e24ef5ef0aa4a7f0ecf2e94150699e48c79139ee12">COLOR_BGR2HSV</a> );</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    hsv_half_down = hsv_base( <a class="code" href="../../da/d35/classcv_1_1Range.html">Range</a>( hsv_base.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>/2, hsv_base.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> - 1 ), <a class="code" href="../../da/d35/classcv_1_1Range.html">Range</a>( 0, hsv_base.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a> - 1 ) );</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordtype">int</span> h_bins = 50; <span class="keywordtype">int</span> s_bins = 60;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordtype">int</span> histSize[] = { h_bins, s_bins };</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">// hue varies from 0 to 179, saturation from 0 to 255</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordtype">float</span> h_ranges[] = { 0, 180 };</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordtype">float</span> s_ranges[] = { 0, 256 };</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span>* ranges[] = { h_ranges, s_ranges };</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// Use the o-th and 1-st channels</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordtype">int</span> channels[] = { 0, 1 };</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    MatND hist_base;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    MatND hist_half_down;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    MatND hist_test1;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    MatND hist_test2;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <a class="code" href="../../d6/dc7/group__imgproc__hist.html#ga4b2b5fd75503ff9e6844cc4dcdaed35d">calcHist</a>( &amp;hsv_base, 1, channels, <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>(), hist_base, 2, histSize, ranges, <span class="keyword">true</span>, <span class="keyword">false</span> );</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="../../dc/d84/group__core__basic.html#ga1b6a396a456c8b6c6e4afd8591560d80">normalize</a>( hist_base, hist_base, 0, 1, <a class="code" href="../../d2/de8/group__core__array.html#ggad12cefbcb5291cf958a85b4b67b6149fa9f0c1c342a18114d47b516a88e29822e">NORM_MINMAX</a>, -1, <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>() );</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <a class="code" href="../../d6/dc7/group__imgproc__hist.html#ga4b2b5fd75503ff9e6844cc4dcdaed35d">calcHist</a>( &amp;hsv_half_down, 1, channels, <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>(), hist_half_down, 2, histSize, ranges, <span class="keyword">true</span>, <span class="keyword">false</span> );</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="../../dc/d84/group__core__basic.html#ga1b6a396a456c8b6c6e4afd8591560d80">normalize</a>( hist_half_down, hist_half_down, 0, 1, <a class="code" href="../../d2/de8/group__core__array.html#ggad12cefbcb5291cf958a85b4b67b6149fa9f0c1c342a18114d47b516a88e29822e">NORM_MINMAX</a>, -1, <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>() );</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <a class="code" href="../../d6/dc7/group__imgproc__hist.html#ga4b2b5fd75503ff9e6844cc4dcdaed35d">calcHist</a>( &amp;hsv_test1, 1, channels, <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>(), hist_test1, 2, histSize, ranges, <span class="keyword">true</span>, <span class="keyword">false</span> );</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="../../dc/d84/group__core__basic.html#ga1b6a396a456c8b6c6e4afd8591560d80">normalize</a>( hist_test1, hist_test1, 0, 1, <a class="code" href="../../d2/de8/group__core__array.html#ggad12cefbcb5291cf958a85b4b67b6149fa9f0c1c342a18114d47b516a88e29822e">NORM_MINMAX</a>, -1, <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>() );</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="../../d6/dc7/group__imgproc__hist.html#ga4b2b5fd75503ff9e6844cc4dcdaed35d">calcHist</a>( &amp;hsv_test2, 1, channels, <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>(), hist_test2, 2, histSize, ranges, <span class="keyword">true</span>, <span class="keyword">false</span> );</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <a class="code" href="../../dc/d84/group__core__basic.html#ga1b6a396a456c8b6c6e4afd8591560d80">normalize</a>( hist_test2, hist_test2, 0, 1, <a class="code" href="../../d2/de8/group__core__array.html#ggad12cefbcb5291cf958a85b4b67b6149fa9f0c1c342a18114d47b516a88e29822e">NORM_MINMAX</a>, -1, <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>() );</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; 4; i++ )</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="keywordtype">int</span> compare_method = i;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="keywordtype">double</span> base_base = <a class="code" href="../../d6/dc7/group__imgproc__hist.html#gaf4190090efa5c47cb367cf97a9a519bd">compareHist</a>( hist_base, hist_base, compare_method );</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordtype">double</span> base_half = <a class="code" href="../../d6/dc7/group__imgproc__hist.html#gaf4190090efa5c47cb367cf97a9a519bd">compareHist</a>( hist_base, hist_half_down, compare_method );</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keywordtype">double</span> base_test1 = <a class="code" href="../../d6/dc7/group__imgproc__hist.html#gaf4190090efa5c47cb367cf97a9a519bd">compareHist</a>( hist_base, hist_test1, compare_method );</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordtype">double</span> base_test2 = <a class="code" href="../../d6/dc7/group__imgproc__hist.html#gaf4190090efa5c47cb367cf97a9a519bd">compareHist</a>( hist_base, hist_test2, compare_method );</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        printf( <span class="stringliteral">&quot; Method [%d] Perfect, Base-Half, Base-Test(1), Base-Test(2) : %f, %f, %f, %f \n&quot;</span>, i, base_base, base_half , base_test1, base_test2 );</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    }</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    printf( <span class="stringliteral">&quot;Done \n&quot;</span> );</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;}</div>
<div class="ttc" id="group__imgproc__misc_html_gga4e0972be5de079fed4e3a10e24ef5ef0aa4a7f0ecf2e94150699e48c79139ee12"><div class="ttname"><a href="../../d7/d1b/group__imgproc__misc.html#gga4e0972be5de079fed4e3a10e24ef5ef0aa4a7f0ecf2e94150699e48c79139ee12">cv::COLOR_BGR2HSV</a></div><div class="ttdoc">convert RGB/BGR to HSV (hue saturation value), color conversions </div><div class="ttdef"><b>Definition:</b> imgproc.hpp:554</div></div>
<div class="ttc" id="group__imgproc__misc_html_ga397ae87e1288a81d2363b61574eb8cab"><div class="ttname"><a href="../../d7/d1b/group__imgproc__misc.html#ga397ae87e1288a81d2363b61574eb8cab">cv::cvtColor</a></div><div class="ttdeci">void cvtColor(InputArray src, OutputArray dst, int code, int dstCn=0)</div><div class="ttdoc">Converts an image from one color space to another. </div></div>
<div class="ttc" id="highgui_2highgui_8hpp_html"><div class="ttname"><a href="../../d0/dce/highgui_2highgui_8hpp.html">highgui.hpp</a></div></div>
<div class="ttc" id="classcv_1_1Mat_html_abed816466c45234254d25bc59c31245e"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">cv::Mat::rows</a></div><div class="ttdeci">int rows</div><div class="ttdoc">the number of rows and columns or (-1, -1) when the matrix has more than 2 dimensions ...</div><div class="ttdef"><b>Definition:</b> mat.hpp:1865</div></div>
<div class="ttc" id="group__imgcodecs_html_ga288b8b3da0892bd651fce07b3bbd3a56"><div class="ttname"><a href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">cv::imread</a></div><div class="ttdeci">Mat imread(const String &amp;filename, int flags=IMREAD_COLOR)</div><div class="ttdoc">Loads an image from a file. </div></div>
<div class="ttc" id="group__imgproc__hist_html_gaf4190090efa5c47cb367cf97a9a519bd"><div class="ttname"><a href="../../d6/dc7/group__imgproc__hist.html#gaf4190090efa5c47cb367cf97a9a519bd">cv::compareHist</a></div><div class="ttdeci">double compareHist(InputArray H1, InputArray H2, int method)</div><div class="ttdoc">Compares two histograms. </div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="../../d8/dcc/namespacestd.html">std</a></div><div class="ttdoc">STL namespace. </div></div>
<div class="ttc" id="namespacecv_html"><div class="ttname"><a href="../../d2/d75/namespacecv.html">cv</a></div><div class="ttdef"><b>Definition:</b> affine.hpp:51</div></div>
<div class="ttc" id="imgcodecs_8hpp_html"><div class="ttname"><a href="../../d6/d87/imgcodecs_8hpp.html">imgcodecs.hpp</a></div></div>
<div class="ttc" id="classcv_1_1Mat_html_aa3e5a47585c9ef6a0842556739155e3e"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cv::Mat::cols</a></div><div class="ttdeci">int cols</div><div class="ttdef"><b>Definition:</b> mat.hpp:1865</div></div>
<div class="ttc" id="imgproc_2imgproc_8hpp_html"><div class="ttname"><a href="../../d5/dba/imgproc_2imgproc_8hpp.html">imgproc.hpp</a></div></div>
<div class="ttc" id="group__core__basic_html_ga1b6a396a456c8b6c6e4afd8591560d80"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga1b6a396a456c8b6c6e4afd8591560d80">cv::normalize</a></div><div class="ttdeci">static Vec&lt; _Tp, cn &gt; normalize(const Vec&lt; _Tp, cn &gt; &amp;v)</div></div>
<div class="ttc" id="group__imgproc__hist_html_ga4b2b5fd75503ff9e6844cc4dcdaed35d"><div class="ttname"><a href="../../d6/dc7/group__imgproc__hist.html#ga4b2b5fd75503ff9e6844cc4dcdaed35d">cv::calcHist</a></div><div class="ttdeci">void calcHist(const Mat *images, int nimages, const int *channels, InputArray mask, OutputArray hist, int dims, const int *histSize, const float **ranges, bool uniform=true, bool accumulate=false)</div><div class="ttdoc">Calculates a histogram of a set of arrays. </div></div>
<div class="ttc" id="classcv_1_1Range_html"><div class="ttname"><a href="../../da/d35/classcv_1_1Range.html">cv::Range</a></div><div class="ttdoc">Template class specifying a continuous subsequence (slice) of a sequence. </div><div class="ttdef"><b>Definition:</b> types.hpp:531</div></div>
<div class="ttc" id="group__core__array_html_ggad12cefbcb5291cf958a85b4b67b6149fa9f0c1c342a18114d47b516a88e29822e"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ggad12cefbcb5291cf958a85b4b67b6149fa9f0c1c342a18114d47b516a88e29822e">cv::NORM_MINMAX</a></div><div class="ttdoc">flag </div><div class="ttdef"><b>Definition:</b> base.hpp:176</div></div>
<div class="ttc" id="classcv_1_1Mat_html"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html">cv::Mat</a></div><div class="ttdoc">n-dimensional dense array class </div><div class="ttdef"><b>Definition:</b> mat.hpp:726</div></div>
</div><!-- fragment --><h2>Explanation </h2>
<ol type="1">
<li>Declare variables such as the matrices to store the base image and the two other images to compare ( RGB and HSV ) <div class="fragment"><div class="line">Mat src_base, hsv_base;</div>
<div class="line">Mat src_test1, hsv_test1;</div>
<div class="line">Mat src_test2, hsv_test2;</div>
<div class="line">Mat hsv_half_down;</div>
</div><!-- fragment --></li>
<li>Load the base image (src_base) and the other two test images: <div class="fragment"><div class="line"><span class="keywordflow">if</span>( argc &lt; 4 )</div>
<div class="line">  { printf(<span class="stringliteral">&quot;** Error. Usage: ./compareHist_Demo &lt;image_settings0&gt; &lt;image_setting1&gt; &lt;image_settings2&gt;\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">src_base = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>( argv[1], 1 );</div>
<div class="line">src_test1 = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>( argv[2], 1 );</div>
<div class="line">src_test2 = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>( argv[3], 1 );</div>
</div><!-- fragment --></li>
<li>Convert them to HSV format: <div class="fragment"><div class="line"><a class="code" href="../../d7/d1b/group__imgproc__misc.html#ga397ae87e1288a81d2363b61574eb8cab">cvtColor</a>( src_base, hsv_base, <a class="code" href="../../d7/d1b/group__imgproc__misc.html#gga4e0972be5de079fed4e3a10e24ef5ef0aa4a7f0ecf2e94150699e48c79139ee12">COLOR_BGR2HSV</a> );</div>
<div class="line"><a class="code" href="../../d7/d1b/group__imgproc__misc.html#ga397ae87e1288a81d2363b61574eb8cab">cvtColor</a>( src_test1, hsv_test1, <a class="code" href="../../d7/d1b/group__imgproc__misc.html#gga4e0972be5de079fed4e3a10e24ef5ef0aa4a7f0ecf2e94150699e48c79139ee12">COLOR_BGR2HSV</a> );</div>
<div class="line"><a class="code" href="../../d7/d1b/group__imgproc__misc.html#ga397ae87e1288a81d2363b61574eb8cab">cvtColor</a>( src_test2, hsv_test2, <a class="code" href="../../d7/d1b/group__imgproc__misc.html#gga4e0972be5de079fed4e3a10e24ef5ef0aa4a7f0ecf2e94150699e48c79139ee12">COLOR_BGR2HSV</a> );</div>
</div><!-- fragment --></li>
<li>Also, create an image of half the base image (in HSV format): <div class="fragment"><div class="line">hsv_half_down = hsv_base( Range( hsv_base.rows/2, hsv_base.rows - 1 ), Range( 0, hsv_base.cols - 1 ) );</div>
</div><!-- fragment --></li>
<li>Initialize the arguments to calculate the histograms (bins, ranges and channels H and S ). <div class="fragment"><div class="line"><span class="keywordtype">int</span> h_bins = 50; <span class="keywordtype">int</span> s_bins = 60;</div>
<div class="line"><span class="keywordtype">int</span> histSize[] = { h_bins, s_bins };</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">float</span> h_ranges[] = { 0, 180 };</div>
<div class="line"><span class="keywordtype">float</span> s_ranges[] = { 0, 256 };</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">float</span>* ranges[] = { h_ranges, s_ranges };</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> channels[] = { 0, 1 };</div>
</div><!-- fragment --></li>
<li>Create the MatND objects to store the histograms: <div class="fragment"><div class="line">MatND hist_base;</div>
<div class="line">MatND hist_half_down;</div>
<div class="line">MatND hist_test1;</div>
<div class="line">MatND hist_test2;</div>
</div><!-- fragment --></li>
<li>Calculate the Histograms for the base image, the 2 test images and the half-down base image: <div class="fragment"><div class="line"><a class="code" href="../../d6/dc7/group__imgproc__hist.html#ga4b2b5fd75503ff9e6844cc4dcdaed35d">calcHist</a>( &amp;hsv_base, 1, channels, Mat(), hist_base, 2, histSize, ranges, <span class="keyword">true</span>, <span class="keyword">false</span> );</div>
<div class="line"><a class="code" href="../../dc/d84/group__core__basic.html#ga1b6a396a456c8b6c6e4afd8591560d80">normalize</a>( hist_base, hist_base, 0, 1, <a class="code" href="../../d2/de8/group__core__array.html#ggad12cefbcb5291cf958a85b4b67b6149fa9f0c1c342a18114d47b516a88e29822e">NORM_MINMAX</a>, -1, Mat() );</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d6/dc7/group__imgproc__hist.html#ga4b2b5fd75503ff9e6844cc4dcdaed35d">calcHist</a>( &amp;hsv_half_down, 1, channels, Mat(), hist_half_down, 2, histSize, ranges, <span class="keyword">true</span>, <span class="keyword">false</span> );</div>
<div class="line"><a class="code" href="../../dc/d84/group__core__basic.html#ga1b6a396a456c8b6c6e4afd8591560d80">normalize</a>( hist_half_down, hist_half_down, 0, 1, <a class="code" href="../../d2/de8/group__core__array.html#ggad12cefbcb5291cf958a85b4b67b6149fa9f0c1c342a18114d47b516a88e29822e">NORM_MINMAX</a>, -1, Mat() );</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d6/dc7/group__imgproc__hist.html#ga4b2b5fd75503ff9e6844cc4dcdaed35d">calcHist</a>( &amp;hsv_test1, 1, channels, Mat(), hist_test1, 2, histSize, ranges, <span class="keyword">true</span>, <span class="keyword">false</span> );</div>
<div class="line"><a class="code" href="../../dc/d84/group__core__basic.html#ga1b6a396a456c8b6c6e4afd8591560d80">normalize</a>( hist_test1, hist_test1, 0, 1, <a class="code" href="../../d2/de8/group__core__array.html#ggad12cefbcb5291cf958a85b4b67b6149fa9f0c1c342a18114d47b516a88e29822e">NORM_MINMAX</a>, -1, Mat() );</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d6/dc7/group__imgproc__hist.html#ga4b2b5fd75503ff9e6844cc4dcdaed35d">calcHist</a>( &amp;hsv_test2, 1, channels, Mat(), hist_test2, 2, histSize, ranges, <span class="keyword">true</span>, <span class="keyword">false</span> );</div>
<div class="line"><a class="code" href="../../dc/d84/group__core__basic.html#ga1b6a396a456c8b6c6e4afd8591560d80">normalize</a>( hist_test2, hist_test2, 0, 1, <a class="code" href="../../d2/de8/group__core__array.html#ggad12cefbcb5291cf958a85b4b67b6149fa9f0c1c342a18114d47b516a88e29822e">NORM_MINMAX</a>, -1, Mat() );</div>
</div><!-- fragment --></li>
<li>Apply sequentially the 4 comparison methods between the histogram of the base image (hist_base) and the other histograms: <div class="fragment"><div class="line"><span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; 4; i++ )</div>
<div class="line">   { <span class="keywordtype">int</span> compare_method = i;</div>
<div class="line">     <span class="keywordtype">double</span> base_base = <a class="code" href="../../d6/dc7/group__imgproc__hist.html#gaf4190090efa5c47cb367cf97a9a519bd">compareHist</a>( hist_base, hist_base, compare_method );</div>
<div class="line">     <span class="keywordtype">double</span> base_half = <a class="code" href="../../d6/dc7/group__imgproc__hist.html#gaf4190090efa5c47cb367cf97a9a519bd">compareHist</a>( hist_base, hist_half_down, compare_method );</div>
<div class="line">     <span class="keywordtype">double</span> base_test1 = <a class="code" href="../../d6/dc7/group__imgproc__hist.html#gaf4190090efa5c47cb367cf97a9a519bd">compareHist</a>( hist_base, hist_test1, compare_method );</div>
<div class="line">     <span class="keywordtype">double</span> base_test2 = <a class="code" href="../../d6/dc7/group__imgproc__hist.html#gaf4190090efa5c47cb367cf97a9a519bd">compareHist</a>( hist_base, hist_test2, compare_method );</div>
<div class="line"></div>
<div class="line">    printf( <span class="stringliteral">&quot; Method [%d] Perfect, Base-Half, Base-Test(1), Base-Test(2) : %f, %f, %f, %f \n&quot;</span>, i, base_base, base_half , base_test1, base_test2 );</div>
<div class="line">  }</div>
</div><!-- fragment --></li>
</ol>
<h2>Results </h2>
<ol type="1">
<li>We use as input the following images: <div class="image">
<img src="../../Histogram_Comparison_Source_0.jpg" alt="Histogram_Comparison_Source_0.jpg"/>
<div class="caption">
Base_0</div></div>
 <div class="image">
<img src="../../Histogram_Comparison_Source_1.jpg" alt="Histogram_Comparison_Source_1.jpg"/>
<div class="caption">
Test_1</div></div>
 <div class="image">
<img src="../../Histogram_Comparison_Source_2.jpg" alt="Histogram_Comparison_Source_2.jpg"/>
<div class="caption">
Test_2</div></div>
 where the first one is the base (to be compared to the others), the other 2 are the test images. We will also compare the first image with respect to itself and with respect of half the base image.</li>
<li>We should expect a perfect match when we compare the base image histogram with itself. Also, compared with the histogram of half the base image, it should present a high match since both are from the same source. For the other two test images, we can observe that they have very different lighting conditions, so the matching should not be very good:</li>
<li>Here the numeric results: <table class="doxtable">
<tr>
<th>*Method* </th><th>Base - Base </th><th>Base - Half </th><th>Base - Test 1 </th><th>Base - Test 2  </th></tr>
<tr>
<td>*Correlation* </td><td>1.000000 </td><td>0.930766 </td><td>0.182073 </td><td>0.120447 </td></tr>
<tr>
<td>*Chi-square* </td><td>0.000000 </td><td>4.940466 </td><td>21.184536 </td><td>49.273437 </td></tr>
<tr>
<td>*Intersection* </td><td>24.391548 </td><td>14.959809 </td><td>3.889029 </td><td>5.775088 </td></tr>
<tr>
<td>*Bhattacharyya* </td><td>0.000000 </td><td>0.222609 </td><td>0.646576 </td><td>0.801869 </td></tr>
</table>
For the <em>Correlation</em> and <em>Intersection</em> methods, the higher the metric, the more accurate the match. As we can see, the match <em>base-base</em> is the highest of all as expected. Also we can observe that the match <em>base-half</em> is the second best match (as we predicted). For the other two metrics, the less the result, the better the match. We can observe that the matches between the test 1 and test 2 with respect to the base are worse, which again, was expected. </li>
</ol>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat May 16 2015 15:12:51 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
