<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>OpenCV: Intel速 IPP Asynchronous C/C++ library in OpenCV</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
MathJax.Hub.Config(
{
  TeX: {
      Macros: {
          matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
          fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
          forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
          vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
          vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
          hdotsfor: ["\\dots", 1],
          mathbbm: ["\\mathbb{#1}", 1],
          bordermatrix: ["\\matrix{#1}", 1]
      }
  }
}
);
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">3.0.0-rc1</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li><a href="../..//3.0-last-rst"><span>Sphinx&#160;Documentation</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="../../de/d7a/tutorial_table_of_content_core.html">The Core Functionality (core module)</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Intel速 IPP Asynchronous C/C++ library in OpenCV </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Goal </h2>
<p>The tutorial demonstrates the <a href="http://software.intel.com/en-us/intel-ipp-preview">Intel速 IPP Asynchronous C/C++</a> library usage with OpenCV. The code example below illustrates implementation of the Sobel operation, accelerated with Intel速 IPP Asynchronous C/C++ functions. In this code example, <a class="el" href="../../d6/dcf/group__core__ipp.html#ga6b6a7a9c44efd50c8aaf9fb0866a363a">cv::hpp::getMat</a> and <a class="el" href="../../d6/dcf/group__core__ipp.html#gae751e7f96d79f90699fdf71bdaa87a6b">cv::hpp::getHpp</a> functions are used for data conversion between <a href="http://software.intel.com/en-us/node/501660">hppiMatrix</a> and Mat matrices.</p>
<h2>Code </h2>
<p>You may also find the source code in the <code>samples/cpp/tutorial_code/core/ippasync/ippasync_sample.cpp</code> file of the OpenCV source library or download it from <a href="https://github.com/Itseez/opencv/tree/master/samples/cpp/tutorial_code/core/ippasync/ippasync_sample.cpp">here</a>.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/d4e/utility_8hpp.html">opencv2/core/utility.hpp</a>&quot;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d46/imgproc_8hpp.html">opencv2/imgproc.hpp</a>&quot;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/dd5/highgui_8hpp.html">opencv2/highgui.hpp</a>&quot;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;cvconfig.h&quot;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d8/dcc/namespacestd.html">std</a>;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d2/d75/namespacecv.html">cv</a>;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#ifdef HAVE_IPP_A</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/ippasync_8hpp.html">opencv2/core/ippasync.hpp</a>&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#define CHECK_STATUS(STATUS, NAME)\</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">    if(STATUS!=HPP_STATUS_NO_ERROR){ printf(&quot;%s error %d\n&quot;, NAME, STATUS);\</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">    if (virtMatrix) {hppStatus delSts = hppiDeleteVirtualMatrices(accel, virtMatrix); CHECK_DEL_STATUS(delSts,&quot;hppiDeleteVirtualMatrices&quot;);}\</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">    if (accel)      {hppStatus delSts = hppDeleteInstance(accel); CHECK_DEL_STATUS(delSts, &quot;hppDeleteInstance&quot;);}\</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">    return -1;}</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#define CHECK_DEL_STATUS(STATUS, NAME)\</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">    if(STATUS!=HPP_STATUS_NO_ERROR){ printf(&quot;%s error %d\n&quot;, NAME, STATUS); return -1;}</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> help()</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;{</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; printf(<span class="stringliteral">&quot;\nThis program shows how to use the conversion for IPP Async.\n&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="stringliteral">&quot;This example uses the Sobel filter.\n&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="stringliteral">&quot;You can use cv::Sobel or hppiSobel.\n&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="stringliteral">&quot;Usage: \n&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="stringliteral">&quot;./ipp_async_sobel [--camera]=&lt;use camera,if this key is present&gt;, \n&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="stringliteral">&quot;                  [--file_name]=&lt;path to movie or image file&gt;\n&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="stringliteral">&quot;                  [--accel]=&lt;accelerator type: auto (default), cpu, gpu&gt;\n\n&quot;</span>);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;}</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span>* keys =</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;{</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="stringliteral">&quot;{c  camera   |           | use camera or not}&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="stringliteral">&quot;{fn file_name|../data/baboon.jpg | image file       }&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="stringliteral">&quot;{a accel     |auto       | accelerator type: auto (default), cpu, gpu}&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;};</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">//this is a sample for hppiSobel functions</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span>** argv)</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;{</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    help();</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="../../d8/dfe/classcv_1_1VideoCapture.html">VideoCapture</a> cap;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="../../d0/d2e/classcv_1_1CommandLineParser.html">CommandLineParser</a> parser(argc, argv, keys);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> image, gray, result;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#ifdef HAVE_IPP_A</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    hppiMatrix* src,* dst;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    hppAccel accel = 0;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    hppAccelType accelType;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    hppStatus sts;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    hppiVirtualMatrix * virtMatrix;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordtype">bool</span> useCamera = parser.has(<span class="stringliteral">&quot;camera&quot;</span>);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordtype">string</span> file = parser.get&lt;<span class="keywordtype">string</span>&gt;(<span class="stringliteral">&quot;file_name&quot;</span>);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordtype">string</span> sAccel = parser.get&lt;<span class="keywordtype">string</span>&gt;(<span class="stringliteral">&quot;accel&quot;</span>);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    parser.printMessage();</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">if</span>( useCamera )</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        printf(<span class="stringliteral">&quot;used camera\n&quot;</span>);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        cap.<a class="code" href="../../d8/dfe/classcv_1_1VideoCapture.html#ab5b7391cd5ec50e7237e575a758f6f05">open</a>(0);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    }</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        printf(<span class="stringliteral">&quot;used image %s\n&quot;</span>, file.c_str());</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        cap.<a class="code" href="../../d8/dfe/classcv_1_1VideoCapture.html#ab5b7391cd5ec50e7237e575a758f6f05">open</a>(file.c_str());</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    }</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordflow">if</span>( !cap.<a class="code" href="../../d8/dfe/classcv_1_1VideoCapture.html#ad62969b4aaa492f9ed021263d1a42f1b">isOpened</a>() )</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        printf(<span class="stringliteral">&quot;can not open camera or video file\n&quot;</span>);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    }</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    accelType = sAccel == <span class="stringliteral">&quot;cpu&quot;</span> ? HPP_ACCEL_TYPE_CPU:</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                sAccel == <span class="stringliteral">&quot;gpu&quot;</span> ? HPP_ACCEL_TYPE_GPU:</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                                  HPP_ACCEL_TYPE_ANY;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">//Create accelerator instance</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    sts = hppCreateInstance(accelType, 0, &amp;accel);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    CHECK_STATUS(sts, <span class="stringliteral">&quot;hppCreateInstance&quot;</span>);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    accelType = hppQueryAccelType(accel);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    sAccel = accelType == HPP_ACCEL_TYPE_CPU ? <span class="stringliteral">&quot;cpu&quot;</span>:</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;             accelType == HPP_ACCEL_TYPE_GPU ? <span class="stringliteral">&quot;gpu&quot;</span>:</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;             accelType == HPP_ACCEL_TYPE_GPU_VIA_DX9 ? <span class="stringliteral">&quot;gpu dx9&quot;</span>: <span class="stringliteral">&quot;?&quot;</span>;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    printf(<span class="stringliteral">&quot;accelType %s\n&quot;</span>, sAccel.c_str());</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    virtMatrix = hppiCreateVirtualMatrices(accel, 1);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">for</span>(;;)</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    {</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        cap &gt;&gt; image;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keywordflow">if</span>(image.empty())</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <a class="code" href="../../d7/d1b/group__imgproc__misc.html#ga397ae87e1288a81d2363b61574eb8cab">cvtColor</a>( image, gray, <a class="code" href="../../d7/d1b/group__imgproc__misc.html#gga4e0972be5de079fed4e3a10e24ef5ef0a353a4b8db9040165db4dacb5bcefb6ea">COLOR_BGR2GRAY</a> );</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        result.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a55ced2c8d844d683ea9a725c60037ad0">create</a>( image.rows, image.cols, <a class="code" href="../../dc/dcc/cvdef_8h.html#a32b18d904ee2b1731a9416a8eef67d06">CV_8U</a>);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keywordtype">double</span> execTime = (double)<a class="code" href="../../db/de0/group__core__utils.html#gae73f58000611a1af25dd36d496bf4487">getTickCount</a>();</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="comment">//convert Mat to hppiMatrix</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        src = <a class="code" href="../../d6/dcf/group__core__ipp.html#gae751e7f96d79f90699fdf71bdaa87a6b">hpp::getHpp</a>(gray,accel);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        dst = <a class="code" href="../../d6/dcf/group__core__ipp.html#gae751e7f96d79f90699fdf71bdaa87a6b">hpp::getHpp</a>(result,accel);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        sts = hppiSobel(accel,src, HPP_MASK_SIZE_3X3,HPP_NORM_L1,virtMatrix[0]);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        CHECK_STATUS(sts,<span class="stringliteral">&quot;hppiSobel&quot;</span>);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        sts = hppiConvert(accel, virtMatrix[0], 0, HPP_RND_MODE_NEAR, dst, HPP_DATA_TYPE_8U);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        CHECK_STATUS(sts,<span class="stringliteral">&quot;hppiConvert&quot;</span>);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="comment">// Wait for tasks to complete</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        sts = hppWait(accel, HPP_TIME_OUT_INFINITE);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        CHECK_STATUS(sts, <span class="stringliteral">&quot;hppWait&quot;</span>);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        execTime = ((double)<a class="code" href="../../db/de0/group__core__utils.html#gae73f58000611a1af25dd36d496bf4487">getTickCount</a>() - execTime)*1000./<a class="code" href="../../db/de0/group__core__utils.html#ga705441a9ef01f47acdc55d87fbe5090c">getTickFrequency</a>();</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        printf(<span class="stringliteral">&quot;Time : %0.3fms\n&quot;</span>, execTime);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;image&quot;</span>, image);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;rez&quot;</span>, result);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <a class="code" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>(15);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        sts =  hppiFreeMatrix(src);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        CHECK_DEL_STATUS(sts,<span class="stringliteral">&quot;hppiFreeMatrix&quot;</span>);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        sts =  hppiFreeMatrix(dst);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        CHECK_DEL_STATUS(sts,<span class="stringliteral">&quot;hppiFreeMatrix&quot;</span>);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">if</span> (!useCamera)</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <a class="code" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>(0);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">if</span> (virtMatrix)</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        sts = hppiDeleteVirtualMatrices(accel, virtMatrix);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        CHECK_DEL_STATUS(sts,<span class="stringliteral">&quot;hppiDeleteVirtualMatrices&quot;</span>);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">if</span> (accel)</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        sts = hppDeleteInstance(accel);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        CHECK_DEL_STATUS(sts, <span class="stringliteral">&quot;hppDeleteInstance&quot;</span>);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    printf(<span class="stringliteral">&quot;SUCCESS\n&quot;</span>);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    printf(<span class="stringliteral">&quot;IPP Async not supported\n&quot;</span>);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;}</div>
<div class="ttc" id="ippasync_8hpp_html"><div class="ttname"><a href="../../d1/d8c/ippasync_8hpp.html">ippasync.hpp</a></div></div>
<div class="ttc" id="group__core__ipp_html_gae751e7f96d79f90699fdf71bdaa87a6b"><div class="ttname"><a href="../../d6/dcf/group__core__ipp.html#gae751e7f96d79f90699fdf71bdaa87a6b">cv::hpp::getHpp</a></div><div class="ttdeci">hppiMatrix * getHpp(const Mat &amp;src, hppAccel accel)</div><div class="ttdoc">Create hppiMatrix from Mat. </div><div class="ttdef"><b>Definition:</b> ippasync.hpp:168</div></div>
<div class="ttc" id="cvdef_8h_html_a32b18d904ee2b1731a9416a8eef67d06"><div class="ttname"><a href="../../dc/dcc/cvdef_8h.html#a32b18d904ee2b1731a9416a8eef67d06">CV_8U</a></div><div class="ttdeci">#define CV_8U</div><div class="ttdef"><b>Definition:</b> cvdef.h:101</div></div>
<div class="ttc" id="group__imgproc__misc_html_ga397ae87e1288a81d2363b61574eb8cab"><div class="ttname"><a href="../../d7/d1b/group__imgproc__misc.html#ga397ae87e1288a81d2363b61574eb8cab">cv::cvtColor</a></div><div class="ttdeci">void cvtColor(InputArray src, OutputArray dst, int code, int dstCn=0)</div><div class="ttdoc">Converts an image from one color space to another. </div></div>
<div class="ttc" id="classcv_1_1VideoCapture_html_ab5b7391cd5ec50e7237e575a758f6f05"><div class="ttname"><a href="../../d8/dfe/classcv_1_1VideoCapture.html#ab5b7391cd5ec50e7237e575a758f6f05">cv::VideoCapture::open</a></div><div class="ttdeci">virtual bool open(const String &amp;filename)</div><div class="ttdoc">Open video file or a capturing device for video capturing. </div></div>
<div class="ttc" id="group__core__utils_html_ga705441a9ef01f47acdc55d87fbe5090c"><div class="ttname"><a href="../../db/de0/group__core__utils.html#ga705441a9ef01f47acdc55d87fbe5090c">cv::getTickFrequency</a></div><div class="ttdeci">double getTickFrequency()</div><div class="ttdoc">Returns the number of ticks per second. </div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="../../d8/dcc/namespacestd.html">std</a></div><div class="ttdoc">STL namespace. </div></div>
<div class="ttc" id="highgui_8hpp_html"><div class="ttname"><a href="../../d4/dd5/highgui_8hpp.html">highgui.hpp</a></div></div>
<div class="ttc" id="group__highgui_html_ga453d42fe4cb60e5723281a89973ee563"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv::imshow</a></div><div class="ttdeci">void imshow(const String &amp;winname, InputArray mat)</div><div class="ttdoc">Displays an image in the specified window. </div></div>
<div class="ttc" id="namespacecv_html"><div class="ttname"><a href="../../d2/d75/namespacecv.html">cv</a></div><div class="ttdef"><b>Definition:</b> affine.hpp:51</div></div>
<div class="ttc" id="classcv_1_1CommandLineParser_html"><div class="ttname"><a href="../../d0/d2e/classcv_1_1CommandLineParser.html">cv::CommandLineParser</a></div><div class="ttdoc">designed for command line arguments parsing </div><div class="ttdef"><b>Definition:</b> utility.hpp:594</div></div>
<div class="ttc" id="classcv_1_1VideoCapture_html"><div class="ttname"><a href="../../d8/dfe/classcv_1_1VideoCapture.html">cv::VideoCapture</a></div><div class="ttdoc">Class for video capturing from video files, image sequences or cameras. The class provides C++ API fo...</div><div class="ttdef"><b>Definition:</b> videoio.hpp:429</div></div>
<div class="ttc" id="imgproc_8hpp_html"><div class="ttname"><a href="../../dd/d46/imgproc_8hpp.html">imgproc.hpp</a></div></div>
<div class="ttc" id="utility_8hpp_html"><div class="ttname"><a href="../../d1/d4e/utility_8hpp.html">utility.hpp</a></div></div>
<div class="ttc" id="classcv_1_1VideoCapture_html_ad62969b4aaa492f9ed021263d1a42f1b"><div class="ttname"><a href="../../d8/dfe/classcv_1_1VideoCapture.html#ad62969b4aaa492f9ed021263d1a42f1b">cv::VideoCapture::isOpened</a></div><div class="ttdeci">virtual bool isOpened() const </div><div class="ttdoc">Returns true if video capturing has been initialized already. </div></div>
<div class="ttc" id="classcv_1_1Mat_html_a55ced2c8d844d683ea9a725c60037ad0"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a55ced2c8d844d683ea9a725c60037ad0">cv::Mat::create</a></div><div class="ttdeci">void create(int rows, int cols, int type)</div><div class="ttdoc">Allocates new array data if needed. </div></div>
<div class="ttc" id="group__core__utils_html_gae73f58000611a1af25dd36d496bf4487"><div class="ttname"><a href="../../db/de0/group__core__utils.html#gae73f58000611a1af25dd36d496bf4487">cv::getTickCount</a></div><div class="ttdeci">int64 getTickCount()</div><div class="ttdoc">Returns the number of ticks. </div></div>
<div class="ttc" id="classcv_1_1Mat_html"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html">cv::Mat</a></div><div class="ttdoc">n-dimensional dense array class </div><div class="ttdef"><b>Definition:</b> mat.hpp:726</div></div>
<div class="ttc" id="group__imgproc__misc_html_gga4e0972be5de079fed4e3a10e24ef5ef0a353a4b8db9040165db4dacb5bcefb6ea"><div class="ttname"><a href="../../d7/d1b/group__imgproc__misc.html#gga4e0972be5de079fed4e3a10e24ef5ef0a353a4b8db9040165db4dacb5bcefb6ea">cv::COLOR_BGR2GRAY</a></div><div class="ttdoc">convert between RGB/BGR and grayscale, color conversions </div><div class="ttdef"><b>Definition:</b> imgproc.hpp:511</div></div>
<div class="ttc" id="group__highgui_html_ga5628525ad33f52eab17feebcfba38bd7"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">cv::waitKey</a></div><div class="ttdeci">int waitKey(int delay=0)</div><div class="ttdoc">Waits for a pressed key. </div></div>
</div><!-- fragment --><h2>Explanation </h2>
<ol type="1">
<li>Create parameters for OpenCV: <div class="fragment"><div class="line">VideoCapture cap;</div>
<div class="line">Mat image, gray, result;</div>
</div><!-- fragment --> and IPP Async: <div class="fragment"><div class="line">hppiMatrix* src,* dst;</div>
<div class="line">hppAccel accel = 0;</div>
<div class="line">hppAccelType accelType;</div>
<div class="line">hppStatus sts;</div>
<div class="line">hppiVirtualMatrix * virtMatrix;</div>
</div><!-- fragment --></li>
<li>Load input image or video. How to open and read video stream you can see in the <a class="el" href="../../d5/dc4/tutorial_video_input_psnr_ssim.html">Video Input with OpenCV and similarity measurement</a> tutorial. <div class="fragment"><div class="line"><span class="keywordflow">if</span>( useCamera )</div>
<div class="line">{</div>
<div class="line">   printf(<span class="stringliteral">&quot;used camera\n&quot;</span>);</div>
<div class="line">   cap.open(0);</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">{</div>
<div class="line">   printf(<span class="stringliteral">&quot;used image %s\n&quot;</span>, file.c_str());</div>
<div class="line">   cap.open(file.c_str());</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">if</span>( !cap.isOpened() )</div>
<div class="line">{</div>
<div class="line">   printf(<span class="stringliteral">&quot;can not open camera or video file\n&quot;</span>);</div>
<div class="line">   <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Create accelerator instance using <a href="http://software.intel.com/en-us/node/501686">hppCreateInstance</a>: <div class="fragment"><div class="line">accelType = sAccel == <span class="stringliteral">&quot;cpu&quot;</span> ? HPP_ACCEL_TYPE_CPU:</div>
<div class="line">            sAccel == <span class="stringliteral">&quot;gpu&quot;</span> ? HPP_ACCEL_TYPE_GPU:</div>
<div class="line">                              HPP_ACCEL_TYPE_ANY;</div>
<div class="line"></div>
<div class="line"><span class="comment">//Create accelerator instance</span></div>
<div class="line">sts = hppCreateInstance(accelType, 0, &amp;accel);</div>
<div class="line">CHECK_STATUS(sts, <span class="stringliteral">&quot;hppCreateInstance&quot;</span>);</div>
</div><!-- fragment --></li>
<li>Create an array of virtual matrices using <a href="http://software.intel.com/en-us/node/501700">hppiCreateVirtualMatrices</a> function. <div class="fragment"><div class="line">virtMatrix = hppiCreateVirtualMatrices(accel, 1);</div>
</div><!-- fragment --></li>
<li>Prepare a matrix for input and output data: <div class="fragment"><div class="line">cap &gt;&gt; image;</div>
<div class="line"><span class="keywordflow">if</span>(image.empty())</div>
<div class="line">   <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d7/d1b/group__imgproc__misc.html#ga397ae87e1288a81d2363b61574eb8cab">cvtColor</a>( image, gray, <a class="code" href="../../d7/d1b/group__imgproc__misc.html#gga4e0972be5de079fed4e3a10e24ef5ef0a353a4b8db9040165db4dacb5bcefb6ea">COLOR_BGR2GRAY</a> );</div>
<div class="line"></div>
<div class="line">result.create( image.rows, image.cols, <a class="code" href="../../dc/dcc/cvdef_8h.html#a32b18d904ee2b1731a9416a8eef67d06">CV_8U</a>);</div>
</div><!-- fragment --></li>
<li>Convert Mat to <a href="http://software.intel.com/en-us/node/501660">hppiMatrix</a> using <a class="el" href="../../d6/dcf/group__core__ipp.html#gae751e7f96d79f90699fdf71bdaa87a6b">cv::hpp::getHpp</a> and call <a href="http://software.intel.com/en-us/node/474701">hppiSobel</a> function. <div class="fragment"><div class="line"><span class="comment">//convert Mat to hppiMatrix</span></div>
<div class="line">src = <a class="code" href="../../d6/dcf/group__core__ipp.html#gae751e7f96d79f90699fdf71bdaa87a6b">getHpp</a>(gray, accel);</div>
<div class="line">dst = <a class="code" href="../../d6/dcf/group__core__ipp.html#gae751e7f96d79f90699fdf71bdaa87a6b">getHpp</a>(result, accel);</div>
<div class="line"></div>
<div class="line">sts = hppiSobel(accel,src, HPP_MASK_SIZE_3X3,HPP_NORM_L1,virtMatrix[0]);</div>
<div class="line">CHECK_STATUS(sts,<span class="stringliteral">&quot;hppiSobel&quot;</span>);</div>
<div class="line"></div>
<div class="line">sts = hppiConvert(accel, virtMatrix[0], 0, HPP_RND_MODE_NEAR, dst, HPP_DATA_TYPE_8U);</div>
<div class="line">CHECK_STATUS(sts,<span class="stringliteral">&quot;hppiConvert&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Wait for tasks to complete</span></div>
<div class="line">sts = hppWait(accel, HPP_TIME_OUT_INFINITE);</div>
<div class="line">CHECK_STATUS(sts, <span class="stringliteral">&quot;hppWait&quot;</span>);</div>
</div><!-- fragment --> We use <a href="http://software.intel.com/en-us/node/501746">hppiConvert</a> because <a href="http://software.intel.com/en-us/node/474701">hppiSobel</a> returns destination matrix with HPP_DATA_TYPE_16S data type for source matrix with HPP_DATA_TYPE_8U type. You should check hppStatus after each call IPP Async function.</li>
<li>Create windows and show the images, the usual way. <div class="fragment"><div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;image&quot;</span>, image);</div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;rez&quot;</span>, result);</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>(15);</div>
</div><!-- fragment --></li>
<li>Delete hpp matrices. <div class="fragment"><div class="line">sts =  hppiFreeMatrix(src);</div>
<div class="line">CHECK_DEL_STATUS(sts,<span class="stringliteral">&quot;hppiFreeMatrix&quot;</span>);</div>
<div class="line"></div>
<div class="line">sts =  hppiFreeMatrix(dst);</div>
<div class="line">CHECK_DEL_STATUS(sts,<span class="stringliteral">&quot;hppiFreeMatrix&quot;</span>);</div>
</div><!-- fragment --></li>
<li>Delete virtual matrices and accelerator instance. <div class="fragment"><div class="line"><span class="keywordflow">if</span> (virtMatrix)</div>
<div class="line">{</div>
<div class="line">   sts = hppiDeleteVirtualMatrices(accel, virtMatrix);</div>
<div class="line">   CHECK_DEL_STATUS(sts,<span class="stringliteral">&quot;hppiDeleteVirtualMatrices&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">if</span> (accel)</div>
<div class="line">{</div>
<div class="line">   sts = hppDeleteInstance(accel);</div>
<div class="line">   CHECK_DEL_STATUS(sts, <span class="stringliteral">&quot;hppDeleteInstance&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ol>
<h2>Result </h2>
<p>After compiling the code above we can execute it giving an image or video path and accelerator type as an argument. For this tutorial we use baboon.png image as input. The result is below.</p>
<div class="image">
<img src="../../How_To_Use_IPPA_Result.jpg" alt="How_To_Use_IPPA_Result.jpg"/>
</div>
 </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat May 16 2015 15:12:49 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
