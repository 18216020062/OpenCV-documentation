<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>OpenCV: Features2d</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
MathJax.Hub.Config(
{
  TeX: {
      Macros: {
          matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
          fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
          forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
          vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
          vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
          hdotsfor: ["\\dots", 1],
          mathbbm: ["\\mathbb{#1}", 1],
          bordermatrix: ["\\matrix{#1}", 1]
      }
  }
}
);
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">3.0.0-rc1</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li><a href="../..//3.0-last-rst"><span>Sphinx&#160;Documentation</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../de/d7b/tutorial_user_guide.html">OpenCV User Guide</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Features2d </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Detectors </h2>
<h2>Descriptors </h2>
<h2>Matching keypoints </h2>
<h3>The code</h3>
<p>We will start with a short sample `opencv/samples/cpp/matcher_simple.cpp`:</p>
<div class="fragment"><div class="line">Mat img1 = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>(argv[1], <a class="code" href="../../d4/da8/group__imgcodecs.html#gga2c6cc144c9eee043575d5b311ac8af08ae29981cfc153d3b0cef5c0daeedd2125">IMREAD_GRAYSCALE</a>);</div>
<div class="line">Mat img2 = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>(argv[2], <a class="code" href="../../d4/da8/group__imgcodecs.html#gga2c6cc144c9eee043575d5b311ac8af08ae29981cfc153d3b0cef5c0daeedd2125">IMREAD_GRAYSCALE</a>);</div>
<div class="line"><span class="keywordflow">if</span>(img1.empty() || img2.empty())</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;Can&#39;t read one of the images\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// detecting keypoints</span></div>
<div class="line">SurfFeatureDetector detector(400);</div>
<div class="line">vector&lt;KeyPoint&gt; keypoints1, keypoints2;</div>
<div class="line">detector.detect(img1, keypoints1);</div>
<div class="line">detector.detect(img2, keypoints2);</div>
<div class="line"></div>
<div class="line"><span class="comment">// computing descriptors</span></div>
<div class="line">SurfDescriptorExtractor extractor;</div>
<div class="line">Mat descriptors1, descriptors2;</div>
<div class="line">extractor.<a class="code" href="../../d0/d13/classcv_1_1Feature2D.html#ab3cce8d56f4fc5e1d530b5931e1e8dc0">compute</a>(img1, keypoints1, descriptors1);</div>
<div class="line">extractor.compute(img2, keypoints2, descriptors2);</div>
<div class="line"></div>
<div class="line"><span class="comment">// matching descriptors</span></div>
<div class="line">BruteForceMatcher&lt;L2&lt;float&gt; &gt; matcher;</div>
<div class="line">vector&lt;DMatch&gt; matches;</div>
<div class="line">matcher.match(descriptors1, descriptors2, matches);</div>
<div class="line"></div>
<div class="line"><span class="comment">// drawing the results</span></div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">namedWindow</a>(<span class="stringliteral">&quot;matches&quot;</span>, 1);</div>
<div class="line">Mat img_matches;</div>
<div class="line"><a class="code" href="../../d4/d5d/group__features2d__draw.html#ga7421b3941617d7267e3f2311582f49e1">drawMatches</a>(img1, keypoints1, img2, keypoints2, matches, img_matches);</div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;matches&quot;</span>, img_matches);</div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>(0);</div>
</div><!-- fragment --><h3>The code explained</h3>
<p>Let us break the code down. </p><div class="fragment"><div class="line">Mat img1 = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>(argv[1], <a class="code" href="../../d4/da8/group__imgcodecs.html#gga2c6cc144c9eee043575d5b311ac8af08ae29981cfc153d3b0cef5c0daeedd2125">IMREAD_GRAYSCALE</a>);</div>
<div class="line">Mat img2 = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>(argv[2], <a class="code" href="../../d4/da8/group__imgcodecs.html#gga2c6cc144c9eee043575d5b311ac8af08ae29981cfc153d3b0cef5c0daeedd2125">IMREAD_GRAYSCALE</a>);</div>
<div class="line"><span class="keywordflow">if</span>(img1.empty() || img2.empty())</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;Can&#39;t read one of the images\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
</div><!-- fragment --><p> We load two images and check if they are loaded correctly. </p><div class="fragment"><div class="line"><span class="comment">// detecting keypoints</span></div>
<div class="line">Ptr&lt;FeatureDetector&gt; detector = FastFeatureDetector::create(15);</div>
<div class="line">vector&lt;KeyPoint&gt; keypoints1, keypoints2;</div>
<div class="line">detector-&gt;detect(img1, keypoints1);</div>
<div class="line">detector-&gt;detect(img2, keypoints2);</div>
</div><!-- fragment --><p> First, we create an instance of a keypoint detector. All detectors inherit the abstract FeatureDetector interface, but the constructors are algorithm-dependent. The first argument to each detector usually controls the balance between the amount of keypoints and their stability. The range of values is different for different detectors (For instance, <em>FAST</em> threshold has the meaning of pixel intensity difference and usually varies in the region *[0,40]*. <em>SURF</em> threshold is applied to a Hessian of an image and usually takes on values larger than <em>100</em>), so use defaults in case of doubt. </p><div class="fragment"><div class="line"><span class="comment">// computing descriptors</span></div>
<div class="line">Ptr&lt;SURF&gt; extractor = SURF::create();</div>
<div class="line">Mat descriptors1, descriptors2;</div>
<div class="line">extractor-&gt;compute(img1, keypoints1, descriptors1);</div>
<div class="line">extractor-&gt;compute(img2, keypoints2, descriptors2);</div>
</div><!-- fragment --><p> We create an instance of descriptor extractor. The most of OpenCV descriptors inherit DescriptorExtractor abstract interface. Then we compute descriptors for each of the keypoints. The output Mat of the DescriptorExtractor::compute method contains a descriptor in a row <em>i</em> for each <em>i</em>-th keypoint. Note that the method can modify the keypoints vector by removing the keypoints such that a descriptor for them is not defined (usually these are the keypoints near image border). The method makes sure that the ouptut keypoints and descriptors are consistent with each other (so that the number of keypoints is equal to the descriptors row count). : </p><div class="fragment"><div class="line"><span class="comment">// matching descriptors</span></div>
<div class="line">BruteForceMatcher&lt;L2&lt;float&gt; &gt; matcher;</div>
<div class="line">vector&lt;DMatch&gt; matches;</div>
<div class="line">matcher.match(descriptors1, descriptors2, matches);</div>
</div><!-- fragment --><p> Now that we have descriptors for both images, we can match them. First, we create a matcher that for each descriptor from image 2 does exhaustive search for the nearest descriptor in image 1 using Euclidean metric. Manhattan distance is also implemented as well as a Hamming distance for Brief descriptor. The output vector matches contains pairs of corresponding points indices. : </p><div class="fragment"><div class="line"><span class="comment">// drawing the results</span></div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">namedWindow</a>(<span class="stringliteral">&quot;matches&quot;</span>, 1);</div>
<div class="line">Mat img_matches;</div>
<div class="line"><a class="code" href="../../d4/d5d/group__features2d__draw.html#ga7421b3941617d7267e3f2311582f49e1">drawMatches</a>(img1, keypoints1, img2, keypoints2, matches, img_matches);</div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;matches&quot;</span>, img_matches);</div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>(0);</div>
</div><!-- fragment --><p> The final part of the sample is about visualizing the matching results. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat May 16 2015 15:12:55 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
