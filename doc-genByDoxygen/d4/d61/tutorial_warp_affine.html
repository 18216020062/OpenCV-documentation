<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>OpenCV: Affine Transformations</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
MathJax.Hub.Config(
{
  TeX: {
      Macros: {
          matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
          fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
          forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
          vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
          vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
          hdotsfor: ["\\dots", 1],
          mathbbm: ["\\mathbb{#1}", 1],
          bordermatrix: ["\\matrix{#1}", 1]
      }
  }
}
);
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">3.0.0-rc1</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li><a href="../..//3.0-last-rst"><span>Sphinx&#160;Documentation</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="../../d7/da8/tutorial_table_of_content_imgproc.html">Image Processing (imgproc module)</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Affine Transformations </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Goal </h2>
<p>In this tutorial you will learn how to:</p>
<ul>
<li>Use the OpenCV function <a class="el" href="../../da/d54/group__imgproc__transform.html#ga0203d9ee5fcd28d40dbc4a1ea4451983">cv::warpAffine</a> to implement simple remapping routines.</li>
<li>Use the OpenCV function <a class="el" href="../../da/d54/group__imgproc__transform.html#gafbbc470ce83812914a70abfb604f4326">cv::getRotationMatrix2D</a> to obtain a \(2 \times 3\) rotation matrix</li>
</ul>
<h2>Theory </h2>
<h3>What is an Affine Transformation?</h3>
<ol type="1">
<li>It is any transformation that can be expressed in the form of a <em>matrix multiplication</em> (linear transformation) followed by a <em>vector addition</em> (translation).</li>
<li><p class="startli">From the above, We can use an Affine Transformation to express:</p><ol type="a">
<li>Rotations (linear transformation)</li>
<li>Translations (vector addition)</li>
<li>Scale operations (linear transformation)</li>
</ol>
<p class="startli">you can see that, in essence, an Affine Transformation represents a <b>relation</b> between two images.</p>
</li>
<li><p class="startli">The usual way to represent an Affine Transform is by using a \(2 \times 3\) matrix.</p>
<p class="formulaDsp">
\[ A = \begin{bmatrix} a_{00} &amp; a_{01} \\ a_{10} &amp; a_{11} \end{bmatrix}_{2 \times 2} B = \begin{bmatrix} b_{00} \\ b_{10} \end{bmatrix}_{2 \times 1} \]
</p>
 <p class="formulaDsp">
\[ M = \begin{bmatrix} A &amp; B \end{bmatrix} = \begin{bmatrix} a_{00} &amp; a_{01} &amp; b_{00} \\ a_{10} &amp; a_{11} &amp; b_{10} \end{bmatrix}_{2 \times 3} \]
</p>
<p class="startli">Considering that we want to transform a 2D vector \(X = \begin{bmatrix}x \\ y\end{bmatrix}\) by using \(A\) and \(B\), we can do it equivalently with:</p>
<p class="startli">\(T = A \cdot \begin{bmatrix}x \\ y\end{bmatrix} + B\) or \(T = M \cdot [x, y, 1]^{T}\)</p>
<p class="formulaDsp">
\[T = \begin{bmatrix} a_{00}x + a_{01}y + b_{00} \\ a_{10}x + a_{11}y + b_{10} \end{bmatrix}\]
</p>
</li>
</ol>
<h3>How do we get an Affine Transformation?</h3>
<ol type="1">
<li>Excellent question. We mentioned that an Affine Transformation is basically a <b>relation</b> between two images. The information about this relation can come, roughly, in two ways:<ol type="a">
<li>We know both \(X\) and T and we also know that they are related. Then our job is to find \(M\)</li>
<li>We know \(M\) and \(X\). To obtain \(T\) we only need to apply \(T = M \cdot X\). Our information for \(M\) may be explicit (i.e. have the 2-by-3 matrix) or it can come as a geometric relation between points.</li>
</ol>
</li>
<li><p class="startli">Let's explain a little bit better (b). Since \(M\) relates 02 images, we can analyze the simplest case in which it relates three points in both images. Look at the figure below:</p>
<div class="image">
<img src="../../Warp_Affine_Tutorial_Theory_0.jpg" alt="Warp_Affine_Tutorial_Theory_0.jpg"/>
</div>
<p class="startli">the points 1, 2 and 3 (forming a triangle in image 1) are mapped into image 2, still forming a triangle, but now they have changed notoriously. If we find the Affine Transformation with these 3 points (you can choose them as you like), then we can apply this found relation to the whole pixels in the image.</p>
</li>
</ol>
<h2>Code </h2>
<ol type="1">
<li><b>What does this program do?</b><ul>
<li>Loads an image</li>
<li>Applies an Affine Transform to the image. This Transform is obtained from the relation between three points. We use the function <a class="el" href="../../da/d54/group__imgproc__transform.html#ga0203d9ee5fcd28d40dbc4a1ea4451983">cv::warpAffine</a> for that purpose.</li>
<li>Applies a Rotation to the image after being transformed. This rotation is with respect to the image center</li>
<li>Waits until the user exits the program</li>
</ul>
</li>
<li>The tutorial code's is shown lines below. You can also download it from <a href="https://github.com/Itseez/opencv/tree/master/samples/cpp/tutorial_code/ImgTrans/Geometric_Transforms_Demo.cpp">here</a> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/d87/imgcodecs_8hpp.html">opencv2/imgcodecs.hpp</a>&quot;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/dce/highgui_2highgui_8hpp.html">opencv2/highgui/highgui.hpp</a>&quot;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/dba/imgproc_2imgproc_8hpp.html">opencv2/imgproc/imgproc.hpp</a>&quot;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d2/d75/namespacecv.html">cv</a>;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d8/dcc/namespacestd.html">std</a>;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span>* source_window = <span class="stringliteral">&quot;Source image&quot;</span>;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span>* warp_window = <span class="stringliteral">&quot;Warp&quot;</span>;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span>* warp_rotate_window = <span class="stringliteral">&quot;Warp + Rotate&quot;</span>;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keywordtype">int</span> main( <span class="keywordtype">int</span>, <span class="keywordtype">char</span>** argv )</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;{</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <a class="code" href="../../db/d4e/classcv_1_1Point__.html">Point2f</a> srcTri[3];</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <a class="code" href="../../db/d4e/classcv_1_1Point__.html">Point2f</a> dstTri[3];</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> rot_mat( 2, 3, <a class="code" href="../../dc/dcc/cvdef_8h.html#a32ec76240e43e4c9c7b2e2785180a7e6">CV_32FC1</a> );</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> warp_mat( 2, 3, <a class="code" href="../../dc/dcc/cvdef_8h.html#a32ec76240e43e4c9c7b2e2785180a7e6">CV_32FC1</a> );</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> src, warp_dst, warp_rotate_dst;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  src = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>( argv[1], 1 );</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  warp_dst = <a class="code" href="../../d3/d63/classcv_1_1Mat.html#a0b57b6a326c8876d944d188a46e0f556">Mat::zeros</a>( src.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>, src.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>, src.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa6477efc7399fbe742418250ccf99a4b">type</a>() );</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  srcTri[0] = <a class="code" href="../../dc/d84/group__core__basic.html#ga7d080aa40de011e4410bca63385ffe2a">Point2f</a>( 0,0 );</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  srcTri[1] = <a class="code" href="../../dc/d84/group__core__basic.html#ga7d080aa40de011e4410bca63385ffe2a">Point2f</a>( src.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a> - 1.f, 0 );</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  srcTri[2] = <a class="code" href="../../dc/d84/group__core__basic.html#ga7d080aa40de011e4410bca63385ffe2a">Point2f</a>( 0, src.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> - 1.f );</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  dstTri[0] = <a class="code" href="../../dc/d84/group__core__basic.html#ga7d080aa40de011e4410bca63385ffe2a">Point2f</a>( src.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>*0.0f, src.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>*0.33f );</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  dstTri[1] = <a class="code" href="../../dc/d84/group__core__basic.html#ga7d080aa40de011e4410bca63385ffe2a">Point2f</a>( src.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>*0.85f, src.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>*0.25f );</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  dstTri[2] = <a class="code" href="../../dc/d84/group__core__basic.html#ga7d080aa40de011e4410bca63385ffe2a">Point2f</a>( src.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>*0.15f, src.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>*0.7f );</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  warp_mat = <a class="code" href="../../da/d54/group__imgproc__transform.html#ga8f6d378f9f8eebb5cb55cd3ae295a999">getAffineTransform</a>( srcTri, dstTri );</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <a class="code" href="../../da/d54/group__imgproc__transform.html#ga0203d9ee5fcd28d40dbc4a1ea4451983">warpAffine</a>( src, warp_dst, warp_mat, warp_dst.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>() );</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <a class="code" href="../../db/d4e/classcv_1_1Point__.html">Point</a> center = <a class="code" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">Point</a>( warp_dst.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>/2, warp_dst.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>/2 );</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keywordtype">double</span> angle = -50.0;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordtype">double</span> scale = 0.6;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  rot_mat = <a class="code" href="../../da/d54/group__imgproc__transform.html#gafbbc470ce83812914a70abfb604f4326">getRotationMatrix2D</a>( center, angle, scale );</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <a class="code" href="../../da/d54/group__imgproc__transform.html#ga0203d9ee5fcd28d40dbc4a1ea4451983">warpAffine</a>( warp_dst, warp_rotate_dst, rot_mat, warp_dst.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>() );</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <a class="code" href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">namedWindow</a>( source_window, <a class="code" href="../../d7/dfc/group__highgui.html#gga7956af2ace3d3acb9dae27cc96353a42acf621ace7a54954cbac01df27e47228f">WINDOW_AUTOSIZE</a> );</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>( source_window, src );</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <a class="code" href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">namedWindow</a>( warp_window, <a class="code" href="../../d7/dfc/group__highgui.html#gga7956af2ace3d3acb9dae27cc96353a42acf621ace7a54954cbac01df27e47228f">WINDOW_AUTOSIZE</a> );</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>( warp_window, warp_dst );</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <a class="code" href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">namedWindow</a>( warp_rotate_window, <a class="code" href="../../d7/dfc/group__highgui.html#gga7956af2ace3d3acb9dae27cc96353a42acf621ace7a54954cbac01df27e47228f">WINDOW_AUTOSIZE</a> );</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>( warp_rotate_window, warp_rotate_dst );</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <a class="code" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>(0);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;}</div>
<div class="ttc" id="group__imgproc__transform_html_ga8f6d378f9f8eebb5cb55cd3ae295a999"><div class="ttname"><a href="../../da/d54/group__imgproc__transform.html#ga8f6d378f9f8eebb5cb55cd3ae295a999">cv::getAffineTransform</a></div><div class="ttdeci">Mat getAffineTransform(const Point2f src[], const Point2f dst[])</div><div class="ttdoc">Calculates an affine transform from three pairs of the corresponding points. </div></div>
<div class="ttc" id="highgui_2highgui_8hpp_html"><div class="ttname"><a href="../../d0/dce/highgui_2highgui_8hpp.html">highgui.hpp</a></div></div>
<div class="ttc" id="classcv_1_1Mat_html_abed816466c45234254d25bc59c31245e"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">cv::Mat::rows</a></div><div class="ttdeci">int rows</div><div class="ttdoc">the number of rows and columns or (-1, -1) when the matrix has more than 2 dimensions ...</div><div class="ttdef"><b>Definition:</b> mat.hpp:1865</div></div>
<div class="ttc" id="group__imgcodecs_html_ga288b8b3da0892bd651fce07b3bbd3a56"><div class="ttname"><a href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">cv::imread</a></div><div class="ttdeci">Mat imread(const String &amp;filename, int flags=IMREAD_COLOR)</div><div class="ttdoc">Loads an image from a file. </div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="../../d8/dcc/namespacestd.html">std</a></div><div class="ttdoc">STL namespace. </div></div>
<div class="ttc" id="classcv_1_1Mat_html_a0b57b6a326c8876d944d188a46e0f556"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a0b57b6a326c8876d944d188a46e0f556">cv::Mat::zeros</a></div><div class="ttdeci">static MatExpr zeros(int rows, int cols, int type)</div><div class="ttdoc">Returns a zero array of the specified size and type. </div></div>
<div class="ttc" id="group__highgui_html_ga453d42fe4cb60e5723281a89973ee563"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv::imshow</a></div><div class="ttdeci">void imshow(const String &amp;winname, InputArray mat)</div><div class="ttdoc">Displays an image in the specified window. </div></div>
<div class="ttc" id="namespacecv_html"><div class="ttname"><a href="../../d2/d75/namespacecv.html">cv</a></div><div class="ttdef"><b>Definition:</b> affine.hpp:51</div></div>
<div class="ttc" id="group__imgproc__transform_html_ga0203d9ee5fcd28d40dbc4a1ea4451983"><div class="ttname"><a href="../../da/d54/group__imgproc__transform.html#ga0203d9ee5fcd28d40dbc4a1ea4451983">cv::warpAffine</a></div><div class="ttdeci">void warpAffine(InputArray src, OutputArray dst, InputArray M, Size dsize, int flags=INTER_LINEAR, int borderMode=BORDER_CONSTANT, const Scalar &amp;borderValue=Scalar())</div><div class="ttdoc">Applies an affine transformation to an image. </div></div>
<div class="ttc" id="imgcodecs_8hpp_html"><div class="ttname"><a href="../../d6/d87/imgcodecs_8hpp.html">imgcodecs.hpp</a></div></div>
<div class="ttc" id="classcv_1_1Point___html"><div class="ttname"><a href="../../db/d4e/classcv_1_1Point__.html">cv::Point_&lt; float &gt;</a></div></div>
<div class="ttc" id="classcv_1_1Mat_html_aa3e5a47585c9ef6a0842556739155e3e"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cv::Mat::cols</a></div><div class="ttdeci">int cols</div><div class="ttdef"><b>Definition:</b> mat.hpp:1865</div></div>
<div class="ttc" id="group__core__basic_html_ga7d080aa40de011e4410bca63385ffe2a"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga7d080aa40de011e4410bca63385ffe2a">cv::Point2f</a></div><div class="ttdeci">Point_&lt; float &gt; Point2f</div><div class="ttdef"><b>Definition:</b> types.hpp:179</div></div>
<div class="ttc" id="imgproc_2imgproc_8hpp_html"><div class="ttname"><a href="../../d5/dba/imgproc_2imgproc_8hpp.html">imgproc.hpp</a></div></div>
<div class="ttc" id="classcv_1_1Mat_html_a146f8e8dda07d1365a575ab83d9828d1"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">cv::Mat::size</a></div><div class="ttdeci">MatSize size</div><div class="ttdef"><b>Definition:</b> mat.hpp:1882</div></div>
<div class="ttc" id="group__highgui_html_ga5afdf8410934fd099df85c75b2e0888b"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">cv::namedWindow</a></div><div class="ttdeci">void namedWindow(const String &amp;winname, int flags=WINDOW_AUTOSIZE)</div><div class="ttdoc">Creates a window. </div></div>
<div class="ttc" id="classcv_1_1Mat_html_aa6477efc7399fbe742418250ccf99a4b"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#aa6477efc7399fbe742418250ccf99a4b">cv::Mat::type</a></div><div class="ttdeci">int type() const </div><div class="ttdoc">Returns the type of a matrix element. </div></div>
<div class="ttc" id="cvdef_8h_html_a32ec76240e43e4c9c7b2e2785180a7e6"><div class="ttname"><a href="../../dc/dcc/cvdef_8h.html#a32ec76240e43e4c9c7b2e2785180a7e6">CV_32FC1</a></div><div class="ttdeci">#define CV_32FC1</div><div class="ttdef"><b>Definition:</b> cvdef.h:146</div></div>
<div class="ttc" id="group__highgui_html_gga7956af2ace3d3acb9dae27cc96353a42acf621ace7a54954cbac01df27e47228f"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#gga7956af2ace3d3acb9dae27cc96353a42acf621ace7a54954cbac01df27e47228f">cv::WINDOW_AUTOSIZE</a></div><div class="ttdef"><b>Definition:</b> highgui.hpp:138</div></div>
<div class="ttc" id="classcv_1_1Mat_html"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html">cv::Mat</a></div><div class="ttdoc">n-dimensional dense array class </div><div class="ttdef"><b>Definition:</b> mat.hpp:726</div></div>
<div class="ttc" id="group__core__basic_html_ga1e83eafb2d26b3c93f09e8338bcab192"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">cv::Point</a></div><div class="ttdeci">Point2i Point</div><div class="ttdef"><b>Definition:</b> types.hpp:181</div></div>
<div class="ttc" id="group__imgproc__transform_html_gafbbc470ce83812914a70abfb604f4326"><div class="ttname"><a href="../../da/d54/group__imgproc__transform.html#gafbbc470ce83812914a70abfb604f4326">cv::getRotationMatrix2D</a></div><div class="ttdeci">Mat getRotationMatrix2D(Point2f center, double angle, double scale)</div><div class="ttdoc">Calculates an affine matrix of 2D rotation. </div></div>
<div class="ttc" id="group__highgui_html_ga5628525ad33f52eab17feebcfba38bd7"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">cv::waitKey</a></div><div class="ttdeci">int waitKey(int delay=0)</div><div class="ttdoc">Waits for a pressed key. </div></div>
</div><!-- fragment --></li>
</ol>
<h2>Explanation </h2>
<ol type="1">
<li>Declare some variables we will use, such as the matrices to store our results and 2 arrays of points to store the 2D points that define our Affine Transform. <div class="fragment"><div class="line"><a class="code" href="../../dc/d84/group__core__basic.html#ga7d080aa40de011e4410bca63385ffe2a">Point2f</a> srcTri[3];</div>
<div class="line"><a class="code" href="../../dc/d84/group__core__basic.html#ga7d080aa40de011e4410bca63385ffe2a">Point2f</a> dstTri[3];</div>
<div class="line"></div>
<div class="line">Mat rot_mat( 2, 3, <a class="code" href="../../dc/dcc/cvdef_8h.html#a32ec76240e43e4c9c7b2e2785180a7e6">CV_32FC1</a> );</div>
<div class="line">Mat warp_mat( 2, 3, <a class="code" href="../../dc/dcc/cvdef_8h.html#a32ec76240e43e4c9c7b2e2785180a7e6">CV_32FC1</a> );</div>
<div class="line">Mat src, warp_dst, warp_rotate_dst;</div>
</div><!-- fragment --></li>
<li>Load an image: <div class="fragment"><div class="line">src = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>( argv[1], 1 );</div>
</div><!-- fragment --></li>
<li>Initialize the destination image as having the same size and type as the source: <div class="fragment"><div class="line">warp_dst = Mat::zeros( src.rows, src.cols, src.type() );</div>
</div><!-- fragment --></li>
<li><b>Affine Transform:</b> As we explained lines above, we need two sets of 3 points to derive the affine transform relation. Take a look: <div class="fragment"><div class="line">srcTri[0] = <a class="code" href="../../dc/d84/group__core__basic.html#ga7d080aa40de011e4410bca63385ffe2a">Point2f</a>( 0,0 );</div>
<div class="line">srcTri[1] = <a class="code" href="../../dc/d84/group__core__basic.html#ga7d080aa40de011e4410bca63385ffe2a">Point2f</a>( src.cols - 1, 0 );</div>
<div class="line">srcTri[2] = <a class="code" href="../../dc/d84/group__core__basic.html#ga7d080aa40de011e4410bca63385ffe2a">Point2f</a>( 0, src.rows - 1 );</div>
<div class="line"></div>
<div class="line">dstTri[0] = <a class="code" href="../../dc/d84/group__core__basic.html#ga7d080aa40de011e4410bca63385ffe2a">Point2f</a>( src.cols*0.0, src.rows*0.33 );</div>
<div class="line">dstTri[1] = <a class="code" href="../../dc/d84/group__core__basic.html#ga7d080aa40de011e4410bca63385ffe2a">Point2f</a>( src.cols*0.85, src.rows*0.25 );</div>
<div class="line">dstTri[2] = <a class="code" href="../../dc/d84/group__core__basic.html#ga7d080aa40de011e4410bca63385ffe2a">Point2f</a>( src.cols*0.15, src.rows*0.7 );</div>
</div><!-- fragment --> You may want to draw the points to make a better idea of how they change. Their locations are approximately the same as the ones depicted in the example figure (in the Theory section). You may note that the size and orientation of the triangle defined by the 3 points change.</li>
<li>Armed with both sets of points, we calculate the Affine Transform by using OpenCV function <a class="el" href="../../da/d54/group__imgproc__transform.html#ga8f6d378f9f8eebb5cb55cd3ae295a999">cv::getAffineTransform</a> : <div class="fragment"><div class="line">warp_mat = <a class="code" href="../../da/d54/group__imgproc__transform.html#ga8f6d378f9f8eebb5cb55cd3ae295a999">getAffineTransform</a>( srcTri, dstTri );</div>
</div><!-- fragment --> We get as an output a \(2 \times 3\) matrix (in this case <b>warp_mat</b>)</li>
<li><p class="startli">We apply the Affine Transform just found to the src image </p><div class="fragment"><div class="line"><a class="code" href="../../da/d54/group__imgproc__transform.html#ga0203d9ee5fcd28d40dbc4a1ea4451983">warpAffine</a>( src, warp_dst, warp_mat, warp_dst.size() );</div>
</div><!-- fragment --><p> with the following arguments:</p><ul>
<li><b>src</b>: Input image</li>
<li><b>warp_dst</b>: Output image</li>
<li><b>warp_mat</b>: Affine transform</li>
<li><b>warp_dst.size()</b>: The desired size of the output image</li>
</ul>
<p class="startli">We just got our first transformed image! We will display it in one bit. Before that, we also want to rotate it...</p>
</li>
<li><p class="startli"><b>Rotate:</b> To rotate an image, we need to know two things:</p><ol type="a">
<li>The center with respect to which the image will rotate</li>
<li>The angle to be rotated. In OpenCV a positive angle is counter-clockwise</li>
<li><em>Optional:</em> A scale factor</li>
</ol>
<p class="startli">We define these parameters with the following snippet: </p><div class="fragment"><div class="line"><a class="code" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">Point</a> center = <a class="code" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">Point</a>( warp_dst.cols/2, warp_dst.rows/2 );</div>
<div class="line"><span class="keywordtype">double</span> angle = -50.0;</div>
<div class="line"><span class="keywordtype">double</span> scale = 0.6;</div>
</div><!-- fragment --></li>
<li>We generate the rotation matrix with the OpenCV function <a class="el" href="../../da/d54/group__imgproc__transform.html#gafbbc470ce83812914a70abfb604f4326">cv::getRotationMatrix2D</a> , which returns a \(2 \times 3\) matrix (in this case <em>rot_mat</em>) <div class="fragment"><div class="line">rot_mat = <a class="code" href="../../da/d54/group__imgproc__transform.html#gafbbc470ce83812914a70abfb604f4326">getRotationMatrix2D</a>( center, angle, scale );</div>
</div><!-- fragment --></li>
<li>We now apply the found rotation to the output of our previous Transformation. <div class="fragment"><div class="line"><a class="code" href="../../da/d54/group__imgproc__transform.html#ga0203d9ee5fcd28d40dbc4a1ea4451983">warpAffine</a>( warp_dst, warp_rotate_dst, rot_mat, warp_dst.size() );</div>
</div><!-- fragment --></li>
<li>Finally, we display our results in two windows plus the original image for good measure: <div class="fragment"><div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">namedWindow</a>( source_window, <a class="code" href="../../d7/dfc/group__highgui.html#gga7956af2ace3d3acb9dae27cc96353a42acf621ace7a54954cbac01df27e47228f">WINDOW_AUTOSIZE</a> );</div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>( source_window, src );</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">namedWindow</a>( warp_window, <a class="code" href="../../d7/dfc/group__highgui.html#gga7956af2ace3d3acb9dae27cc96353a42acf621ace7a54954cbac01df27e47228f">WINDOW_AUTOSIZE</a> );</div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>( warp_window, warp_dst );</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">namedWindow</a>( warp_rotate_window, <a class="code" href="../../d7/dfc/group__highgui.html#gga7956af2ace3d3acb9dae27cc96353a42acf621ace7a54954cbac01df27e47228f">WINDOW_AUTOSIZE</a> );</div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>( warp_rotate_window, warp_rotate_dst );</div>
</div><!-- fragment --></li>
<li>We just have to wait until the user exits the program <div class="fragment"><div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>(0);</div>
</div><!-- fragment --></li>
</ol>
<h2>Result </h2>
<ol type="1">
<li><p class="startli">After compiling the code above, we can give it the path of an image as argument. For instance, for a picture like:</p>
<div class="image">
<img src="../../Warp_Affine_Tutorial_Original_Image.jpg" alt="Warp_Affine_Tutorial_Original_Image.jpg"/>
</div>
<p class="startli">after applying the first Affine Transform we obtain:</p>
<div class="image">
<img src="../../Warp_Affine_Tutorial_Result_Warp.jpg" alt="Warp_Affine_Tutorial_Result_Warp.jpg"/>
</div>
<p class="startli">and finally, after applying a negative rotation (remember negative means clockwise) and a scale factor, we get:</p>
<div class="image">
<img src="../../Warp_Affine_Tutorial_Result_Warp_Rotate.jpg" alt="Warp_Affine_Tutorial_Result_Warp_Rotate.jpg"/>
</div>
 </li>
</ol>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat May 16 2015 15:12:52 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
