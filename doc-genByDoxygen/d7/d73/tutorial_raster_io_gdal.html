<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>OpenCV: Reading Geospatial Raster files with GDAL</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
MathJax.Hub.Config(
{
  TeX: {
      Macros: {
          matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
          fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
          forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
          vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
          vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
          hdotsfor: ["\\dots", 1],
          mathbbm: ["\\mathbb{#1}", 1],
          bordermatrix: ["\\matrix{#1}", 1]
      }
  }
}
);
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">3.0.0-rc1</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li><a href="../..//3.0-last-rst"><span>Sphinx&#160;Documentation</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="../../d0/de2/tutorial_table_of_content_highgui.html">High Level GUI and Media (highgui module)</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Reading Geospatial Raster files with GDAL </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Geospatial raster data is a heavily used product in Geographic Information Systems and Photogrammetry. Raster data typically can represent imagery and Digital Elevation Models (DEM). The standard library for loading GIS imagery is the Geographic Data Abstraction Library <a href="http://www.gdal.org">(GDAL)</a>. In this example, we will show techniques for loading GIS raster formats using native OpenCV functions. In addition, we will show some an example of how OpenCV can use this data for novel and interesting purposes.</p>
<h2>Goals </h2>
<p>The primary objectives for this tutorial:</p>
<ul>
<li>How to use OpenCV <a class="el" href="../../d4/da8/group__imgcodecs.html#imread">imread</a> to load satellite imagery.</li>
<li>How to use OpenCV <a class="el" href="../../d4/da8/group__imgcodecs.html#imread">imread</a> to load SRTM Digital Elevation Models</li>
<li>Given the corner coordinates of both the image and DEM, correllate the elevation data to the image to find elevations for each pixel.</li>
<li>Show a basic, easy-to-implement example of a terrain heat map.</li>
<li>Show a basic use of DEM data coupled with ortho-rectified imagery.</li>
</ul>
<p>To implement these goals, the following code takes a Digital Elevation Model as well as a GeoTiff image of San Francisco as input. The image and DEM data is processed and generates a terrain heat map of the image as well as labels areas of the city which would be affected should the water level of the bay rise 10, 50, and 100 meters.</p>
<h2>Code </h2>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * gdal_image.cpp -- Load GIS data into OpenCV Containers using the Geospatial Data Abstraction Library</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// OpenCV Headers</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d8c/core_2core_8hpp.html">opencv2/core/core.hpp</a>&quot;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/dba/imgproc_2imgproc_8hpp.html">opencv2/imgproc/imgproc.hpp</a>&quot;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/dce/highgui_2highgui_8hpp.html">opencv2/highgui/highgui.hpp</a>&quot;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// C++ Standard Libraries</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;stdexcept&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d8/dcc/namespacestd.html">std</a>;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">// define the corner points</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//    Note that GDAL library can natively determine this</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> tl( -122.441017, 37.815664 );</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> tr( -122.370919, 37.815311 );</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> bl( -122.441533, 37.747167 );</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> br( -122.3715,   37.746814 );</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">// determine dem corners</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> dem_bl( -122.0, 38);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> dem_tr( -123.0, 37);</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">// range of the heat map colors</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;std::vector&lt;std::pair&lt;cv::Vec3b,double&gt; &gt; color_range;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">// List of all function prototypes</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> lerp( <span class="keyword">const</span> <a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a>&amp;, <span class="keyword">const</span> <a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a>&amp;, <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; );</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec3b</a> get_dem_color( <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; );</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> world2dem( <span class="keyword">const</span> <a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a>&amp;, <span class="keyword">const</span> <a class="code" href="../../d6/d50/classcv_1_1Size__.html">cv::Size</a>&amp;);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> pixel2world( <span class="keyword">const</span> <span class="keywordtype">int</span>&amp;, <span class="keyword">const</span> <span class="keywordtype">int</span>&amp;, <span class="keyword">const</span> <a class="code" href="../../d6/d50/classcv_1_1Size__.html">cv::Size</a>&amp; );</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="keywordtype">void</span> add_color( <a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec3b</a>&amp; pix, <span class="keyword">const</span> <a class="code" href="../../d5/d64/defs_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>&amp; b, <span class="keyword">const</span> <a class="code" href="../../d5/d64/defs_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>&amp; g, <span class="keyword">const</span> <a class="code" href="../../d5/d64/defs_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>&amp; r );</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"> * Linear Interpolation</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"> * p1 - Point 1</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment"> * p2 - Point 2</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"> * t  - Ratio from Point 1 to Point 2</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> lerp( <a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> <span class="keyword">const</span>&amp; p1, <a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> <span class="keyword">const</span>&amp; p2, <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; t ){</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../dc/d84/group__core__basic.html#ga32986d8c6fd05949688352abd112509f">cv::Point2d</a>( ((1-t)*p1.<a class="code" href="../../db/d4e/classcv_1_1Point__.html#a4c96fa7bdbfe390be5ed356edb274ff3">x</a>) + (t*p2.<a class="code" href="../../db/d4e/classcv_1_1Point__.html#a4c96fa7bdbfe390be5ed356edb274ff3">x</a>),</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                        ((1-t)*p1.<a class="code" href="../../db/d4e/classcv_1_1Point__.html#a157337197338ff199e5df1a393022f15">y</a>) + (t*p2.<a class="code" href="../../db/d4e/classcv_1_1Point__.html#a157337197338ff199e5df1a393022f15">y</a>));</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;}</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment"> * Interpolate Colors</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DATATYPE, <span class="keywordtype">int</span> N&gt;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec&lt;DATATYPE,N&gt;</a> lerp( <a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec&lt;DATATYPE,N&gt;</a> <span class="keyword">const</span>&amp; minColor,</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                          <a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec&lt;DATATYPE,N&gt;</a> <span class="keyword">const</span>&amp; maxColor,</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                          <span class="keywordtype">double</span> <span class="keyword">const</span>&amp; t ){</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec&lt;DATATYPE,N&gt;</a> output;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i&lt;N; i++ ){</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        output[i] = (<a class="code" href="../../d5/d64/defs_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>)(((1-t)*minColor[i]) + (t * maxColor[i]));</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    }</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">return</span> output;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;}</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment"> * Compute the dem color</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec3b</a> get_dem_color( <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; elevation ){</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">// if the elevation is below the minimum, return the minimum</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">if</span>( elevation &lt; color_range[0].second ){</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="keywordflow">return</span> color_range[0].first;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    }</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// if the elevation is above the maximum, return the maximum</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">if</span>( elevation &gt; color_range.back().second ){</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keywordflow">return</span> color_range.back().first;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    }</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">// otherwise, find the proper starting index</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordtype">int</span> idx=0;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordtype">double</span> t = 0;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> x=0; x&lt;(int)(color_range.size()-1); x++ ){</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="comment">// if the current elevation is below the next item, then use the current</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="comment">// two colors as our range</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">if</span>( elevation &lt; color_range[x+1].second ){</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            idx=x;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            t = (color_range[x+1].second - elevation)/</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                (color_range[x+1].second - color_range[x].second);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        }</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">// interpolate the color</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordflow">return</span> lerp( color_range[idx].first, color_range[idx+1].first, t);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;}</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"> * Given a pixel coordinate and the size of the input image, compute the pixel location</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"> * on the DEM image.</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> world2dem( <a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> <span class="keyword">const</span>&amp; coordinate, <span class="keyword">const</span> <a class="code" href="../../d6/d50/classcv_1_1Size__.html">cv::Size</a>&amp; dem_size   ){</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">// relate this to the dem points</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">// ASSUMING THAT DEM DATA IS ORTHORECTIFIED</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordtype">double</span> demRatioX = ((dem_tr.x - coordinate.<a class="code" href="../../db/d4e/classcv_1_1Point__.html#a4c96fa7bdbfe390be5ed356edb274ff3">x</a>)/(dem_tr.x - dem_bl.x));</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordtype">double</span> demRatioY = 1-((dem_tr.y - coordinate.<a class="code" href="../../db/d4e/classcv_1_1Point__.html#a157337197338ff199e5df1a393022f15">y</a>)/(dem_tr.y - dem_bl.y));</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> output;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    output.<a class="code" href="../../db/d4e/classcv_1_1Point__.html#a4c96fa7bdbfe390be5ed356edb274ff3">x</a> = demRatioX * dem_size.<a class="code" href="../../d6/d50/classcv_1_1Size__.html#abfe0367b32c407ddccf5ddf92667c73d">width</a>;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    output.<a class="code" href="../../db/d4e/classcv_1_1Point__.html#a157337197338ff199e5df1a393022f15">y</a> = demRatioY * dem_size.<a class="code" href="../../d6/d50/classcv_1_1Size__.html#a1d289dce6b5d8006a54f3ee0259fc545">height</a>;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordflow">return</span> output;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;}</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment"> * Convert a pixel coordinate to world coordinates</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> pixel2world( <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; x, <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; y, <span class="keyword">const</span> <a class="code" href="../../d6/d50/classcv_1_1Size__.html">cv::Size</a>&amp; size ){</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">// compute the ratio of the pixel location to its dimension</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordtype">double</span> rx = (double)x / size.<a class="code" href="../../d6/d50/classcv_1_1Size__.html#abfe0367b32c407ddccf5ddf92667c73d">width</a>;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordtype">double</span> ry = (<span class="keywordtype">double</span>)y / size.<a class="code" href="../../d6/d50/classcv_1_1Size__.html#a1d289dce6b5d8006a54f3ee0259fc545">height</a>;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment">// compute LERP of each coordinate</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> rightSide = lerp(tr, br, ry);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> leftSide  = lerp(tl, bl, ry);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">// compute the actual Lat/Lon coordinate of the interpolated coordinate</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">return</span> lerp( leftSide, rightSide, rx );</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;}</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment"> * Add color to a specific pixel color value</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="keywordtype">void</span> add_color( <a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec3b</a>&amp; pix, <span class="keyword">const</span> <a class="code" href="../../d5/d64/defs_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>&amp; b, <span class="keyword">const</span> <a class="code" href="../../d5/d64/defs_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>&amp; g, <span class="keyword">const</span> <a class="code" href="../../d5/d64/defs_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>&amp; r ){</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">if</span>( pix[0] + b &lt; 255 &amp;&amp; pix[0] + b &gt;= 0 ){ pix[0] += b; }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordflow">if</span>( pix[1] + g &lt; 255 &amp;&amp; pix[1] + g &gt;= 0 ){ pix[1] += g; }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">if</span>( pix[2] + r &lt; 255 &amp;&amp; pix[2] + r &gt;= 0 ){ pix[2] += r; }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;}</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment"> * Main Function</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="keywordtype">int</span> main( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[] ){</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">     * Check input arguments</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">if</span>( argc &lt; 3 ){</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;usage: &quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; &lt;image&gt; &lt;dem&gt;&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">// load the image (note that we don&#39;t have the projection information.  You will</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// need to load that yourself or use the full GDAL driver.  The values are pre-defined</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">// at the top of this file</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">cv::Mat</a> image = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">cv::imread</a>(argv[1], <a class="code" href="../../d4/da8/group__imgcodecs.html#gga2c6cc144c9eee043575d5b311ac8af08a1b482916f4ffe34f0b90550f267fd896">cv::IMREAD_LOAD_GDAL</a> | <a class="code" href="../../d4/da8/group__imgcodecs.html#gga2c6cc144c9eee043575d5b311ac8af08af660544735200cbe942eea09232eb822">cv::IMREAD_COLOR</a> );</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">// load the dem model</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">cv::Mat</a> dem = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">cv::imread</a>(argv[2], <a class="code" href="../../d4/da8/group__imgcodecs.html#gga2c6cc144c9eee043575d5b311ac8af08a1b482916f4ffe34f0b90550f267fd896">cv::IMREAD_LOAD_GDAL</a> | <a class="code" href="../../d4/da8/group__imgcodecs.html#gga2c6cc144c9eee043575d5b311ac8af08a0b486c93c25e8a0b0712681bb7254c18">cv::IMREAD_ANYDEPTH</a> );</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">// create our output products</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">cv::Mat</a> output_dem(   image.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>(), <a class="code" href="../../dc/dcc/cvdef_8h.html#a88c4cd9de76f678f33928ef1e3f96047">CV_8UC3</a> );</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">cv::Mat</a> output_dem_flood(   image.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>(), <a class="code" href="../../dc/dcc/cvdef_8h.html#a88c4cd9de76f678f33928ef1e3f96047">CV_8UC3</a> );</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="comment">// for sanity sake, make sure GDAL Loads it as a signed short</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">if</span>( dem.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa6477efc7399fbe742418250ccf99a4b">type</a>() != <a class="code" href="../../dc/dcc/cvdef_8h.html#a3515053e24377cf079fa1027d208ad52">CV_16SC1</a> ){ <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;DEM image type must be CV_16SC1&quot;</span>); }</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">// define the color range to create our output DEM heat map</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">//  Pair format ( Color, elevation );  Push from low to high</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">//  Note:  This would be perfect for a configuration file, but is here for a working demo.</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    color_range.push_back( std::pair&lt;cv::Vec3b,double&gt;(<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec3b</a>( 188, 154,  46),   -1));</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    color_range.push_back( std::pair&lt;cv::Vec3b,double&gt;(<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec3b</a>( 110, 220, 110), 0.25));</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    color_range.push_back( std::pair&lt;cv::Vec3b,double&gt;(<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec3b</a>( 150, 250, 230),   20));</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    color_range.push_back( std::pair&lt;cv::Vec3b,double&gt;(<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec3b</a>( 160, 220, 200),   75));</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    color_range.push_back( std::pair&lt;cv::Vec3b,double&gt;(<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec3b</a>( 220, 190, 170),  100));</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    color_range.push_back( std::pair&lt;cv::Vec3b,double&gt;(<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec3b</a>( 250, 180, 140),  200));</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">// define a minimum elevation</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordtype">double</span> minElevation = -10;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="comment">// iterate over each pixel in the image, computing the dem point</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> y=0; y&lt;image.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>; y++ ){</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> x=0; x&lt;image.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>; x++ ){</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="comment">// convert the pixel coordinate to lat/lon coordinates</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> coordinate = pixel2world( x, y, image.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>() );</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="comment">// compute the dem image pixel coordinate from lat/lon</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point2d</a> dem_coordinate = world2dem( coordinate, dem.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>() );</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="comment">// extract the elevation</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="keywordtype">double</span> dz;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="keywordflow">if</span>( dem_coordinate.x &gt;=    0    &amp;&amp; dem_coordinate.y &gt;=    0     &amp;&amp;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            dem_coordinate.x &lt; dem.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a> &amp;&amp; dem_coordinate.y &lt; dem.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> ){</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            dz = dem.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa5d20fc86d41d59e4d71ae93daee9726">at</a>&lt;<span class="keywordtype">short</span>&gt;(dem_coordinate);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            dz = minElevation;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="comment">// write the pixel value to the file</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        output_dem_flood.at&lt;<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec3b</a>&gt;(y,x) = image.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa5d20fc86d41d59e4d71ae93daee9726">at</a>&lt;<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec3b</a>&gt;(y,x);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="comment">// compute the color for the heat map output</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec3b</a> actualColor = get_dem_color(dz);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        output_dem.at&lt;<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec3b</a>&gt;(y,x) = actualColor;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="comment">// show effect of a 10 meter increase in ocean levels</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="keywordflow">if</span>( dz &lt; 10 ){</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            add_color( output_dem_flood.at&lt;<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec3b</a>&gt;(y,x), 90, 0, 0 );</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        }</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="comment">// show effect of a 50 meter increase in ocean levels</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( dz &lt; 50 ){</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            add_color( output_dem_flood.at&lt;<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec3b</a>&gt;(y,x), 0, 90, 0 );</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="comment">// show effect of a 100 meter increase in ocean levels</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( dz &lt; 100 ){</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            add_color( output_dem_flood.at&lt;<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec3b</a>&gt;(y,x), 0, 0, 90 );</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        }</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    }}</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">// print our heat map</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <a class="code" href="../../d4/da8/group__imgcodecs.html#gabbc7ef1aa2edfaa87772f1202d67e0ce">cv::imwrite</a>( <span class="stringliteral">&quot;heat-map.jpg&quot;</span>   ,  output_dem );</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment">// print the flooding effect image</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="../../d4/da8/group__imgcodecs.html#gabbc7ef1aa2edfaa87772f1202d67e0ce">cv::imwrite</a>( <span class="stringliteral">&quot;flooded.jpg&quot;</span>,  output_dem_flood);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;}</div>
<div class="ttc" id="group__imgcodecs_html_gabbc7ef1aa2edfaa87772f1202d67e0ce"><div class="ttname"><a href="../../d4/da8/group__imgcodecs.html#gabbc7ef1aa2edfaa87772f1202d67e0ce">cv::imwrite</a></div><div class="ttdeci">bool imwrite(const String &amp;filename, InputArray img, const std::vector&lt; int &gt; &amp;params=std::vector&lt; int &gt;())</div><div class="ttdoc">Saves an image to a specified file. </div></div>
<div class="ttc" id="highgui_2highgui_8hpp_html"><div class="ttname"><a href="../../d0/dce/highgui_2highgui_8hpp.html">highgui.hpp</a></div></div>
<div class="ttc" id="classcv_1_1Mat_html_abed816466c45234254d25bc59c31245e"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">cv::Mat::rows</a></div><div class="ttdeci">int rows</div><div class="ttdoc">the number of rows and columns or (-1, -1) when the matrix has more than 2 dimensions ...</div><div class="ttdef"><b>Definition:</b> mat.hpp:1865</div></div>
<div class="ttc" id="group__imgcodecs_html_ga288b8b3da0892bd651fce07b3bbd3a56"><div class="ttname"><a href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">cv::imread</a></div><div class="ttdeci">Mat imread(const String &amp;filename, int flags=IMREAD_COLOR)</div><div class="ttdoc">Loads an image from a file. </div></div>
<div class="ttc" id="classcv_1_1Size___html_abfe0367b32c407ddccf5ddf92667c73d"><div class="ttname"><a href="../../d6/d50/classcv_1_1Size__.html#abfe0367b32c407ddccf5ddf92667c73d">cv::Size_::width</a></div><div class="ttdeci">_Tp width</div><div class="ttdef"><b>Definition:</b> types.hpp:302</div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="../../d8/dcc/namespacestd.html">std</a></div><div class="ttdoc">STL namespace. </div></div>
<div class="ttc" id="group__imgcodecs_html_gga2c6cc144c9eee043575d5b311ac8af08a1b482916f4ffe34f0b90550f267fd896"><div class="ttname"><a href="../../d4/da8/group__imgcodecs.html#gga2c6cc144c9eee043575d5b311ac8af08a1b482916f4ffe34f0b90550f267fd896">cv::IMREAD_LOAD_GDAL</a></div><div class="ttdef"><b>Definition:</b> imgcodecs.hpp:68</div></div>
<div class="ttc" id="classcv_1_1Size___html"><div class="ttname"><a href="../../d6/d50/classcv_1_1Size__.html">cv::Size_</a></div><div class="ttdoc">Template class for specifying the size of an image or rectangle. </div><div class="ttdef"><b>Definition:</b> types.hpp:284</div></div>
<div class="ttc" id="classcv_1_1Point___html"><div class="ttname"><a href="../../db/d4e/classcv_1_1Point__.html">cv::Point_</a></div><div class="ttdoc">Template class for 2D points specified by its coordinates x and y. </div><div class="ttdef"><b>Definition:</b> types.hpp:147</div></div>
<div class="ttc" id="classcv_1_1Vec_html"><div class="ttname"><a href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec</a></div><div class="ttdoc">Template class for short numerical vectors, a partial case of Matx. </div><div class="ttdef"><b>Definition:</b> matx.hpp:300</div></div>
<div class="ttc" id="classcv_1_1Mat_html_aa3e5a47585c9ef6a0842556739155e3e"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cv::Mat::cols</a></div><div class="ttdeci">int cols</div><div class="ttdef"><b>Definition:</b> mat.hpp:1865</div></div>
<div class="ttc" id="group__imgcodecs_html_gga2c6cc144c9eee043575d5b311ac8af08a0b486c93c25e8a0b0712681bb7254c18"><div class="ttname"><a href="../../d4/da8/group__imgcodecs.html#gga2c6cc144c9eee043575d5b311ac8af08a0b486c93c25e8a0b0712681bb7254c18">cv::IMREAD_ANYDEPTH</a></div><div class="ttdef"><b>Definition:</b> imgcodecs.hpp:66</div></div>
<div class="ttc" id="imgproc_2imgproc_8hpp_html"><div class="ttname"><a href="../../d5/dba/imgproc_2imgproc_8hpp.html">imgproc.hpp</a></div></div>
<div class="ttc" id="classcv_1_1Mat_html_a146f8e8dda07d1365a575ab83d9828d1"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">cv::Mat::size</a></div><div class="ttdeci">MatSize size</div><div class="ttdef"><b>Definition:</b> mat.hpp:1882</div></div>
<div class="ttc" id="defs_8h_html_a65f85814a8290f9797005d3b28e7e5fc"><div class="ttname"><a href="../../d5/d64/defs_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a></div><div class="ttdeci">unsigned char uchar</div><div class="ttdef"><b>Definition:</b> defs.h:284</div></div>
<div class="ttc" id="group__core__basic_html_ga32986d8c6fd05949688352abd112509f"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga32986d8c6fd05949688352abd112509f">cv::Point2d</a></div><div class="ttdeci">Point_&lt; double &gt; Point2d</div><div class="ttdef"><b>Definition:</b> types.hpp:180</div></div>
<div class="ttc" id="classcv_1_1Size___html_a1d289dce6b5d8006a54f3ee0259fc545"><div class="ttname"><a href="../../d6/d50/classcv_1_1Size__.html#a1d289dce6b5d8006a54f3ee0259fc545">cv::Size_::height</a></div><div class="ttdeci">_Tp height</div><div class="ttdef"><b>Definition:</b> types.hpp:302</div></div>
<div class="ttc" id="classcv_1_1Mat_html_aa6477efc7399fbe742418250ccf99a4b"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#aa6477efc7399fbe742418250ccf99a4b">cv::Mat::type</a></div><div class="ttdeci">int type() const </div><div class="ttdoc">Returns the type of a matrix element. </div></div>
<div class="ttc" id="classcv_1_1Point___html_a4c96fa7bdbfe390be5ed356edb274ff3"><div class="ttname"><a href="../../db/d4e/classcv_1_1Point__.html#a4c96fa7bdbfe390be5ed356edb274ff3">cv::Point_::x</a></div><div class="ttdeci">_Tp x</div><div class="ttdef"><b>Definition:</b> types.hpp:175</div></div>
<div class="ttc" id="cvdef_8h_html_a88c4cd9de76f678f33928ef1e3f96047"><div class="ttname"><a href="../../dc/dcc/cvdef_8h.html#a88c4cd9de76f678f33928ef1e3f96047">CV_8UC3</a></div><div class="ttdeci">#define CV_8UC3</div><div class="ttdef"><b>Definition:</b> cvdef.h:118</div></div>
<div class="ttc" id="classcv_1_1Point___html_a157337197338ff199e5df1a393022f15"><div class="ttname"><a href="../../db/d4e/classcv_1_1Point__.html#a157337197338ff199e5df1a393022f15">cv::Point_::y</a></div><div class="ttdeci">_Tp y</div><div class="ttdef"><b>Definition:</b> types.hpp:175</div></div>
<div class="ttc" id="core_2core_8hpp_html"><div class="ttname"><a href="../../db/d8c/core_2core_8hpp.html">core.hpp</a></div></div>
<div class="ttc" id="classcv_1_1Mat_html"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html">cv::Mat</a></div><div class="ttdoc">n-dimensional dense array class </div><div class="ttdef"><b>Definition:</b> mat.hpp:726</div></div>
<div class="ttc" id="classcv_1_1Mat_html_aa5d20fc86d41d59e4d71ae93daee9726"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#aa5d20fc86d41d59e4d71ae93daee9726">cv::Mat::at</a></div><div class="ttdeci">_Tp &amp; at(int i0=0)</div><div class="ttdoc">Returns a reference to the specified array element. </div></div>
<div class="ttc" id="cvdef_8h_html_a3515053e24377cf079fa1027d208ad52"><div class="ttname"><a href="../../dc/dcc/cvdef_8h.html#a3515053e24377cf079fa1027d208ad52">CV_16SC1</a></div><div class="ttdeci">#define CV_16SC1</div><div class="ttdef"><b>Definition:</b> cvdef.h:134</div></div>
<div class="ttc" id="group__imgcodecs_html_gga2c6cc144c9eee043575d5b311ac8af08af660544735200cbe942eea09232eb822"><div class="ttname"><a href="../../d4/da8/group__imgcodecs.html#gga2c6cc144c9eee043575d5b311ac8af08af660544735200cbe942eea09232eb822">cv::IMREAD_COLOR</a></div><div class="ttdef"><b>Definition:</b> imgcodecs.hpp:65</div></div>
</div><!-- fragment --><h2>How to Read Raster Data using GDAL </h2>
<p>This demonstration uses the default OpenCV imread function. The primary difference is that in order to force GDAL to load the image, you must use the appropriate flag. </p><div class="fragment"><div class="line"><a class="code" href="../../d3/d63/classcv_1_1Mat.html">cv::Mat</a> image = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">cv::imread</a>( argv[1], <a class="code" href="../../d4/da8/group__imgcodecs.html#gga2c6cc144c9eee043575d5b311ac8af08a1b482916f4ffe34f0b90550f267fd896">cv::IMREAD_LOAD_GDAL</a> );</div>
</div><!-- fragment --><p> When loading digital elevation models, the actual numeric value of each pixel is essential and cannot be scaled or truncated. For example, with image data a pixel represented as a double with a value of 1 has an equal appearance to a pixel which is represented as an unsigned character with a value of 255. With terrain data, the pixel value represents the elevation in meters. In order to ensure that OpenCV preserves the native value, use the GDAL flag in imread with the ANYDEPTH flag. </p><div class="fragment"><div class="line"><a class="code" href="../../d3/d63/classcv_1_1Mat.html">cv::Mat</a> dem = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">cv::imread</a>( argv[2], <a class="code" href="../../d4/da8/group__imgcodecs.html#gga2c6cc144c9eee043575d5b311ac8af08a1b482916f4ffe34f0b90550f267fd896">cv::IMREAD_LOAD_GDAL</a> | <a class="code" href="../../d4/da8/group__imgcodecs.html#gga2c6cc144c9eee043575d5b311ac8af08a0b486c93c25e8a0b0712681bb7254c18">cv::IMREAD_ANYDEPTH</a> );</div>
</div><!-- fragment --><p> If you know beforehand the type of DEM model you are loading, then it may be a safe bet to test the Mat::type() or Mat::depth() using an assert or other mechanism. NASA or DOD specification documents can provide the input types for various elevation models. The major types, SRTM and DTED, are both signed shorts.</p>
<h2>Notes </h2>
<h3>Lat/Lon (Geographic) Coordinates should normally be avoided</h3>
<p>The Geographic Coordinate System is a spherical coordinate system, meaning that using them with Cartesian mathematics is technically incorrect. This demo uses them to increase the readability and is accurate enough to make the point. A better coordinate system would be Universal Transverse Mercator.</p>
<h3>Finding the corner coordinates</h3>
<p>One easy method to find the corner coordinates of an image is to use the command-line tool gdalinfo. For imagery which is ortho-rectified and contains the projection information, you can use the <a href="http://http://earthexplorer.usgs.gov">USGS EarthExplorer</a>. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;\f$&gt; gdalinfo N37W123.hgt</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;   Driver: SRTMHGT/SRTMHGT File Format</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;   Files: N37W123.hgt</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;   Size is 3601, 3601</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;   Coordinate System is:</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;   GEOGCS[&quot;WGS 84&quot;,</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;   DATUM[&quot;WGS_1984&quot;,</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;   ... more output ...</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;   Corner Coordinates:</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;   Upper Left  (-123.0001389,  38.0001389) (123d 0&#39; 0.50&quot;W, 38d 0&#39; 0.50&quot;N)</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;   Lower Left  (-123.0001389,  36.9998611) (123d 0&#39; 0.50&quot;W, 36d59&#39;59.50&quot;N)</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;   Upper Right (-121.9998611,  38.0001389) (121d59&#39;59.50&quot;W, 38d 0&#39; 0.50&quot;N)</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;   Lower Right (-121.9998611,  36.9998611) (121d59&#39;59.50&quot;W, 36d59&#39;59.50&quot;N)</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;   Center      (-122.5000000,  37.5000000) (122d30&#39; 0.00&quot;W, 37d30&#39; 0.00&quot;N)</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    ... more output ...</div>
</div><!-- fragment --> <h2>Results </h2>
<p>Below is the output of the program. Use the first image as the input. For the DEM model, download the SRTM file located at the USGS here. <a href="http://dds.cr.usgs.gov/srtm/version2_1/SRTM1/Region_04/N37W123.hgt.zip">http://dds.cr.usgs.gov/srtm/version2_1/SRTM1/Region_04/N37W123.hgt.zip</a></p>
<div class="image">
<img src="../../gdal_output.jpg" alt="gdal_output.jpg"/>
<div class="caption">
Input Image</div></div>
 <div class="image">
<img src="../../gdal_heat-map.jpg" alt="gdal_heat-map.jpg"/>
<div class="caption">
Heat Map</div></div>
 <div class="image">
<img src="../../gdal_flood-zone.jpg" alt="gdal_flood-zone.jpg"/>
<div class="caption">
Heat Map Overlay</div></div>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat May 16 2015 15:12:51 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
